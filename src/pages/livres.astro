---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

// R√©cup√©ration des livres
const books = await getCollection('books');

// Tri des livres par note (du plus √©lev√© au plus bas), puis par ann√©e
const sortedBooks = books.sort((a, b) => {
  if (a.data.note && b.data.note) {
    if (b.data.note !== a.data.note) {
      return b.data.note - a.data.note;
    }
  }
  return (b.data.publishYear || 0) - (a.data.publishYear || 0);
});

// Cat√©gorisation des livres bas√©e sur la profession
const categories = {
  "D√©veloppement & Tech": books.filter(book => 
    book.data.profession === "developpement-web" ||
    book.data.keywords?.toLowerCase().includes('d√©veloppement') ||
    book.data.keywords?.toLowerCase().includes('code') ||
    book.data.keywords?.toLowerCase().includes('programming') ||
    book.data.keywords?.toLowerCase().includes('javascript')
  ),
  "D√©veloppement Personnel": books.filter(book => 
    book.data.profession === "developpement-personnel" ||
    book.data.keywords?.toLowerCase().includes('habitudes') ||
    book.data.keywords?.toLowerCase().includes('productivit√©') ||
    book.data.keywords?.toLowerCase().includes('focus') ||
    book.data.keywords?.toLowerCase().includes('travail')
  ),
  "Business & Strat√©gie": books.filter(book => 
    book.data.profession === "business" ||
    book.data.keywords?.toLowerCase().includes('business') ||
    book.data.keywords?.toLowerCase().includes('startup') ||
    book.data.keywords?.toLowerCase().includes('innovation') ||
    book.data.keywords?.toLowerCase().includes('influence')
  ),
  "Management & Leadership": books.filter(book => 
    book.data.profession === "management" ||
    book.data.keywords?.toLowerCase().includes('management') ||
    book.data.keywords?.toLowerCase().includes('leadership') ||
    book.data.keywords?.toLowerCase().includes('√©quipe') ||
    book.data.keywords?.toLowerCase().includes('entreprise')
  )
};

// Fonction pour obtenir la couleur de la note
function getNoteColor(note: number): string {
  if (note >= 4.5) return "text-green-600 dark:text-green-400";
  if (note >= 4.0) return "text-yellow-600 dark:text-yellow-400";
  if (note >= 3.5) return "text-orange-600 dark:text-orange-400";
  return "text-red-600 dark:text-red-400";
}

// Fonction pour obtenir le texte de la note
function getNoteText(note: number): string {
  if (note >= 4.5) return "Excellent";
  if (note >= 4.0) return "Tr√®s bon";
  if (note >= 3.5) return "Bon";
  return "Moyen";
}

// Statistiques
const totalBooks = books.length;
const averageNote = books.reduce((sum, book) => sum + (book.data.note || 0), 0) / books.length;
const topRatedBooks = books.filter(book => book.data.note && book.data.note >= 4.5).length;
---

<BaseLayout title="Livres Recommand√©s | G√©rald Pam√©ole" description="D√©couvrez ma s√©lection de livres qui ont marqu√© mon parcours professionnel et qui peuvent enrichir le v√¥tre.">
	<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-hidden">
		<!-- Hero Section avec Animation 3D -->
		<section class="relative py-32 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white overflow-hidden">
			<!-- Background Animation Complexe -->
			<div class="absolute inset-0">
				<div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-indigo-600/20 to-purple-600/20"></div>
				<div class="absolute top-1/4 left-1/4 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
				<div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-white/5 rounded-full blur-3xl animate-pulse delay-1000"></div>
				<div class="absolute top-1/2 left-1/2 w-32 h-32 bg-white/15 rounded-full blur-2xl animate-bounce delay-500"></div>
				<!-- Formes g√©om√©triques flottantes -->
				<div class="absolute top-20 left-20 w-4 h-4 bg-white/20 rotate-45 animate-spin"></div>
				<div class="absolute top-40 right-32 w-6 h-6 bg-white/15 rounded-full animate-ping"></div>
				<div class="absolute bottom-32 left-1/3 w-3 h-3 bg-white/25 rotate-12 animate-pulse"></div>
			</div>
			
			<div class="container mx-auto px-4 text-center relative z-10">
				<div class="animate-fade-in-up">
					<h1 class="text-6xl md:text-8xl font-black mb-8 bg-gradient-to-r from-white via-purple-200 to-pink-200 bg-clip-text text-transparent animate-gradient">
						üìö Livres
					</h1>
					<h2 class="text-4xl md:text-6xl font-bold mb-6 text-white/90 animate-slide-in-right">
						Recommand√©s
					</h2>
				</div>
				<p class="text-xl md:text-2xl max-w-4xl mx-auto mb-12 opacity-90 animate-fade-in-up delay-300">
					Une s√©lection <span class="text-yellow-300 font-bold">personnelle</span> de livres qui ont 
					<span class="text-pink-300 font-bold">transform√©</span> ma vision du d√©veloppement, 
					du management et de la <span class="text-cyan-300 font-bold">productivit√©</span>.
				</p>
				
				<!-- Statistiques avec Animation Staggered -->
				<div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
					<div class="group bg-white/10 backdrop-blur-sm rounded-3xl p-8 hover:bg-white/20 transition-all duration-500 transform hover:scale-110 hover:rotate-1 animate-fade-in-up delay-100">
						<div class="text-5xl font-black mb-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
							{totalBooks}
						</div>
						<div class="text-sm opacity-90 font-medium">Livres lus</div>
					</div>
					<div class="group bg-white/10 backdrop-blur-sm rounded-3xl p-8 hover:bg-white/20 transition-all duration-500 transform hover:scale-110 hover:-rotate-1 animate-fade-in-up delay-200">
						<div class="text-5xl font-black mb-2 bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">
							{averageNote.toFixed(1)}
						</div>
						<div class="text-sm opacity-90 font-medium">Note moyenne</div>
					</div>
					<div class="group bg-white/10 backdrop-blur-sm rounded-3xl p-8 hover:bg-white/20 transition-all duration-500 transform hover:scale-110 hover:rotate-1 animate-fade-in-up delay-300">
						<div class="text-5xl font-black mb-2 bg-gradient-to-r from-pink-400 to-purple-500 bg-clip-text text-transparent">
							{topRatedBooks}
						</div>
						<div class="text-sm opacity-90 font-medium">Excellents</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Section Aper√ßu avec Layout Asym√©trique -->
		<section class="py-20 bg-gradient-to-br from-slate-800 to-purple-900 relative">
			<div class="container mx-auto px-4">
				<div class="text-center mb-16">
					<h2 class="text-5xl font-black mb-6 bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent animate-gradient">
						üìñ Ma Biblioth√®que
					</h2>
					<p class="text-xl text-white/80 max-w-3xl mx-auto">
						Une s√©lection <span class="text-yellow-300 font-bold">personnelle</span> de {totalBooks} livres qui ont marqu√© mon parcours professionnel.
					</p>
				</div>

				<!-- Grille Asym√©trique des Meilleurs Livres -->
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
					{sortedBooks.slice(0, 4).map((book, index) => (
						<div class={`group relative animate-fade-in-up delay-${index * 100}`}>
							<div class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm rounded-3xl p-6 hover:from-white/20 hover:to-white/10 transition-all duration-500 transform hover:scale-105 hover:-rotate-1 border border-white/20">
								<div class="flex items-center space-x-4">
									<div class="flex-shrink-0">
										<div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center transform group-hover:rotate-12 transition-transform duration-300">
											<span class="text-white font-black text-xl">
												{book.data.note ? book.data.note.toFixed(1) : 'N/A'}
											</span>
										</div>
									</div>
									<div class="flex-1 min-w-0">
										<h3 class="text-lg font-bold text-white truncate group-hover:text-yellow-300 transition-colors">
											{book.data.title}
										</h3>
										<p class="text-sm text-white/70 truncate">
											{book.data.author}
										</p>
										{book.data.note && (
											<div class="flex items-center mt-2">
												{Array.from({ length: 5 }).map((_, i) => (
													<svg 
														key={i}
														class={`w-4 h-4 ${i < book.data.note! ? 'text-yellow-400' : 'text-white/30'} transform group-hover:scale-110 transition-transform`}
														fill="currentColor" 
														viewBox="0 0 20 20"
													>
														<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
													</svg>
												))}
											</div>
										)}
									</div>
								</div>
							</div>
						</div>
					))}
				</div>

				<!-- Navigation par Cat√©gorie avec Style D√©cal√© -->
				<div class="text-center">
					<h3 class="text-3xl font-bold text-white mb-8">
						Explorez par <span class="text-yellow-300">cat√©gorie</span>
					</h3>
					<div class="flex flex-wrap gap-4 justify-center">
						{Object.entries(categories).map(([categoryName, categoryBooks], index) => (
							<a 
								href={`#${categoryName.toLowerCase().replace(/\s+/g, '-')}`}
								class={`group px-8 py-4 bg-gradient-to-r from-white/10 to-white/5 backdrop-blur-sm text-white rounded-2xl text-lg font-semibold hover:from-white/20 hover:to-white/10 transition-all duration-300 transform hover:scale-105 hover:-rotate-1 border border-white/20 animate-fade-in-up delay-${index * 100}`}
							>
								{categoryName} 
								<span class="ml-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent font-black">
									({categoryBooks.length})
								</span>
							</a>
						))}
					</div>
				</div>
			</div>
		</section>

		<!-- Livres par Cat√©gorie avec Layout Cr√©atif -->
		<section class="py-20 bg-gradient-to-br from-purple-900 to-slate-900">
			<div class="container mx-auto px-4">
				{Object.entries(categories).map(([categoryName, categoryBooks], categoryIndex) => (
					<div id={categoryName.toLowerCase().replace(/\s+/g, '-')} class="mb-32">
						<!-- Header de la cat√©gorie avec Style D√©cal√© -->
						<div class="text-center mb-16">
							<div class="inline-block transform rotate-2">
								<h2 class="text-6xl font-black mb-4 bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent animate-gradient">
									{categoryName}
								</h2>
							</div>
							<div class="inline-block transform -rotate-1 bg-white/10 backdrop-blur-sm rounded-2xl px-6 py-3 border border-white/20">
								<p class="text-lg text-white/80 font-medium">
									{categoryBooks.length} livre{categoryBooks.length > 1 ? 's' : ''} dans cette cat√©gorie
								</p>
							</div>
						</div>

						<!-- Grille Cr√©ative des Livres -->
						{categoryBooks.length > 0 ? (
							<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
								{categoryBooks.map((book, index) => (
									<div class={`group relative animate-fade-in-up delay-${index * 150}`}>
										<div class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden hover:shadow-purple-500/25 transition-all duration-500 transform hover:scale-105 hover:-rotate-1 border border-white/20">
											<!-- Image de couverture avec effet parallax -->
											<div class="relative h-64 bg-gradient-to-br from-indigo-500 to-purple-600 overflow-hidden">
												<div class="absolute inset-0 bg-black/30"></div>
												
												<!-- Note et ann√©e avec style d√©cal√© -->
												<div class="absolute top-4 left-4 transform -rotate-2">
													<div class="bg-white/20 backdrop-blur-sm rounded-xl px-3 py-2 border border-white/30">
														<span class="text-white text-sm font-bold">{book.data.publishYear}</span>
													</div>
												</div>
												
												{book.data.note && (
													<div class="absolute top-4 right-4 transform rotate-2">
														<div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl px-3 py-2">
															<div class="flex items-center">
																{Array.from({ length: 5 }).map((_, i) => (
																	<svg 
																		key={i}
																		class={`w-4 h-4 ${i < book.data.note! ? 'text-white' : 'text-white/50'}`}
																		fill="currentColor" 
																		viewBox="0 0 20 20"
																	>
																		<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
																	</svg>
																))}
															</div>
														</div>
													</div>
												)}

												{book.data.note && book.data.note >= 4.5 && (
													<div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 rotate-3">
														<span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-yellow-900 px-4 py-2 rounded-full text-sm font-bold shadow-lg">
															‚≠ê Recommand√©
														</span>
													</div>
												)}
											</div>

											<!-- Contenu du livre avec style cr√©atif -->
											<div class="p-8">
												<h3 class="text-2xl font-bold text-white mb-3 group-hover:text-yellow-300 transition-colors line-clamp-2">
													{book.data.title}
												</h3>
												<p class="text-sm text-white/70 mb-4">
													par <span class="font-semibold text-white">{book.data.author}</span>
													{book.data.publishYear && (
														<span class="text-white/50"> ‚Ä¢ {book.data.publishYear}</span>
													)}
												</p>
												
												<!-- R√©sum√© avec style d√©cal√© -->
												<div class="mb-6">
													<p class="text-white/80 text-sm line-clamp-3 mb-4">
														{book.data.description}
													</p>
													
													{book.body && (
														<div class="bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10">
															<p class="text-xs text-white/60 italic line-clamp-2">
																{book.body.substring(0, 150)}...
															</p>
														</div>
													)}
												</div>
												
												<!-- Keywords avec style cr√©atif -->
												{book.data.keywords && (
													<div class="mb-6">
														<div class="flex flex-wrap gap-2">
															{book.data.keywords.split(',').slice(0, 3).map((keyword, i) => (
																<span class={`px-3 py-1 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 text-indigo-300 text-xs rounded-full border border-indigo-400/30 transform hover:scale-110 transition-transform`}>
																	{keyword.trim()}
																</span>
															))}
														</div>
													</div>
												)}

												<!-- Contenu li√© avec style d√©cal√© -->
												{book.data.relatedContent && book.data.relatedContent.length > 0 && (
													<div class="mb-6">
														<p class="text-xs text-white/50 mb-3 font-medium">Contenu li√© :</p>
														<div class="space-y-2">
															{book.data.relatedContent.slice(0, 2).map((related) => (
																<a 
																	href={related.url}
																	class="block text-xs text-indigo-300 hover:text-yellow-300 transition-colors truncate transform hover:translate-x-2"
																>
																	{related.type === 'article' ? 'üìÑ' : 'üìö'} {related.title}
																</a>
															))}
														</div>
													</div>
												)}

												<!-- Actions avec style cr√©atif -->
												<div class="flex items-center justify-between pt-4 border-t border-white/20">
													<a 
														href={`/books/${book.slug}`}
														class="inline-flex items-center text-yellow-300 hover:text-yellow-200 font-semibold text-sm transform hover:scale-105 transition-all"
													>
														Lire la critique
														<svg class="ml-2 w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
														</svg>
													</a>
													
													{book.data.amazonLink && (
														<a 
															href={book.data.amazonLink}
															target="_blank"
															rel="noopener noreferrer"
															class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full hover:from-orange-600 hover:to-red-600 transition-all transform hover:scale-105 shadow-lg"
														>
															<svg class="w-3 h-3 mr-2" fill="currentColor" viewBox="0 0 24 24">
																<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
															</svg>
															Amazon
														</a>
													)}
												</div>
											</div>
										</div>
									</div>
								))}
							</div>
						) : (
							<div class="text-center py-16">
								<div class="w-24 h-24 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-6 transform rotate-12">
									<i class="fas fa-book text-3xl text-white/50"></i>
								</div>
								<h3 class="text-2xl font-bold text-white mb-4">Aucun livre dans cette cat√©gorie</h3>
								<p class="text-white/60">Des livres seront bient√¥t ajout√©s dans cette cat√©gorie.</p>
							</div>
						)}
					</div>
				))}
			</div>
		</section>

		<!-- CTA Section avec Style D√©cal√© -->
		<section class="py-24 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white relative overflow-hidden">
			<!-- Background Animation -->
			<div class="absolute inset-0">
				<div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-indigo-600/20 to-purple-600/20"></div>
				<div class="absolute top-1/4 left-1/4 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
				<div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-white/5 rounded-full blur-3xl animate-pulse delay-1000"></div>
			</div>
			
			<div class="container mx-auto px-4 text-center relative z-10">
				<div class="transform -rotate-1 inline-block">
					<h2 class="text-6xl font-black mb-8 bg-gradient-to-r from-white via-yellow-200 to-pink-200 bg-clip-text text-transparent animate-gradient">
						Une recommandation ?
					</h2>
				</div>
				<p class="text-2xl mb-12 max-w-4xl mx-auto opacity-90">
					Vous avez lu un livre qui vous a <span class="text-yellow-300 font-bold">marqu√©</span> ? 
					N'h√©sitez pas √† me le <span class="text-pink-300 font-bold">recommander</span> !
				</p>
				<div class="flex flex-col sm:flex-row gap-8 justify-center">
					<a 
						href="/contact" 
						class="group inline-flex items-center px-12 py-6 bg-white text-indigo-600 font-bold rounded-2xl hover:bg-gray-100 transition-all duration-300 transform hover:scale-110 hover:-rotate-1 shadow-2xl"
					>
						Me recommander un livre
						<svg class="ml-3 w-6 h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
						</svg>
					</a>
					<a 
						href="/blog" 
						class="group inline-flex items-center px-12 py-6 border-2 border-white text-white font-bold rounded-2xl hover:bg-white hover:text-indigo-600 transition-all duration-300 transform hover:scale-110 hover:rotate-1"
					>
						Voir mes articles
						<svg class="ml-3 w-6 h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</a>
				</div>
			</div>
		</section>
	</div>
</BaseLayout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	@keyframes fade-in-up {
		from { 
			opacity: 0; 
			transform: translateY(30px); 
		}
		to { 
			opacity: 1; 
			transform: translateY(0); 
		}
	}

	@keyframes slide-in-right {
		from { 
			opacity: 0; 
			transform: translateX(30px); 
		}
		to { 
			opacity: 1; 
			transform: translateX(0); 
		}
	}

	@keyframes gradient {
		0%, 100% { background-position: 0% 50%; }
		50% { background-position: 100% 50%; }
	}

	.animate-fade-in-up {
		animation: fade-in-up 0.8s ease-out forwards;
	}

	.animate-slide-in-right {
		animation: slide-in-right 1s ease-out;
	}

	.animate-gradient {
		background-size: 200% 200%;
		animation: gradient 3s ease infinite;
	}

	/* D√©lais d'animation */
	.delay-100 { animation-delay: 0.1s; }
	.delay-200 { animation-delay: 0.2s; }
	.delay-300 { animation-delay: 0.3s; }
	.delay-500 { animation-delay: 0.5s; }
	.delay-1000 { animation-delay: 1s; }

	/* Effets de hover avanc√©s */
	.group:hover .group-hover\:translate-x-1 {
		transform: translateX(0.25rem);
	}

	.group:hover .group-hover\:scale-110 {
		transform: scale(1.1);
	}

	.group:hover .group-hover\:rotate-12 {
		transform: rotate(12deg);
	}

	/* Scroll animations */
	@media (prefers-reduced-motion: no-preference) {
		.animate-fade-in-up {
			opacity: 0;
			transform: translateY(30px);
			animation: fade-in-up 0.8s ease-out forwards;
		}
	}
</style>
