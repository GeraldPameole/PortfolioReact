---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

// Récupération des projets
const projects = await getCollection('work');

// Tri des projets par date de publication (du plus récent au plus ancien)
const sortedProjects = projects.sort((a, b) => {
	return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime();
});

// Définir les catégories de projets avec les mêmes codes couleurs que les domaines d'expertise
const projectCategories = {
	'management': {
		name: 'Gestion de Projet Télécom',
		icon: 'fas fa-tasks',
		color: 'blue',
		colorClass: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
		description: 'Coordination d\'équipes multidisciplinaires, processus d\'optimisation et infrastructures télécom.',
		examples: ['Business: The Ultimate Resource', 'Tout comprendre à l\'entreprise']
	},
	'developpement-web': {
		name: 'Développement Web',
		icon: 'fas fa-laptop-code',
		color: 'green',
		colorClass: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
		description: 'Applications web, frameworks et technologies front/back-end.',
		examples: ['Design Patterns', 'Patterns of Enterprise Application Architecture']
	},
	'business': {
		name: 'Développement Commercial',
		icon: 'fas fa-handshake',
		color: 'orange',
		colorClass: 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300',
		description: 'Stratégies commerciales, relation client et techniques de vente.',
		examples: ['Le Personal MBA', 'Lean Startup', 'Zero to One']
	},
	'qualite-process': {
		name: 'Qualité & Process',
		icon: 'fas fa-check-circle',
		color: 'purple',
		colorClass: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300',
		description: 'Clean code, DevOps, tests et intégration continue.',
		examples: ['The DevOps Handbook', 'Clean Code']
	},
	'developpement-personnel': {
		name: 'Formation & Pédagogie',
		icon: 'fas fa-graduation-cap',
		color: 'red',
		colorClass: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300',
		description: 'Accompagnement, programmes de formation et optimisation des performances.',
		examples: ['Atomic Habits', 'La Bible de l\'efficacité professionnelle']
	}
};

// Rôles par catégorie (affiché sur la carte)
const roleByCategory = {
	management: "Chef de Projet Télécom",
	'developpement-web': "Développeur Web Full Stack",
	business: "Manager d'Équipe Commerciale",
	'qualite-process': "Responsable Qualité & Process",
	'developpement-personnel': "Formateur & Coach"
};

// Grouper les projets par catégorie
const groupedProjects: Record<string, typeof projects> = {};
for (const category in projectCategories) {
	groupedProjects[category] = [];
}
groupedProjects['autre'] = [];

// Assigner les projets aux catégories appropriées
sortedProjects.forEach(project => {
	let assigned = false;
	if (project.data.technologies) {
		const techs = project.data.technologies.map((t: string) => t.toLowerCase());
		
		// Règles d'assignation basées sur les technologies
		if (techs.some((t: string) => ['react', 'vue', 'angular', 'javascript', 'typescript', 'html', 'css', 'web'].includes(t))) {
			groupedProjects['developpement-web'].push(project);
			assigned = true;
		} 
		else if (techs.some((t: string) => ['ios', 'android', 'react native', 'flutter', 'swift', 'kotlin', 'mobile'].includes(t))) {
			groupedProjects['developpement-web'].push(project);
			assigned = true;
		}
		else if (techs.some((t: string) => ['gestion', 'management', 'agile', 'scrum', 'kanban', 'jira'].includes(t))) {
			groupedProjects['management'].push(project);
			assigned = true;
		}
		else if (techs.some((t: string) => ['formation', 'learning', 'elearning', 'conseil', 'consulting', 'productivité', 'habitudes'].includes(t))) {
			groupedProjects['developpement-personnel'].push(project);
			assigned = true;
		}
		else if (techs.some((t: string) => ['vente', 'commercial', 'business', 'marketing', 'crm', 'client', 'startup', 'innovation'].includes(t))) {
			groupedProjects['business'].push(project);
			assigned = true;
		}
		else if (techs.some((t: string) => ['qualité', 'process', 'devops', 'test', 'ci/cd', 'clean code'].includes(t))) {
			groupedProjects['qualite-process'].push(project);
			assigned = true;
		}
	}
	
	if (!assigned) {
		groupedProjects['autre'].push(project);
	}
});

// Fonction pour formater la date
function formatDate(date: Date): string {
	return date.toLocaleDateString('fr-FR', {
		year: 'numeric',
		month: 'long',
		day: 'numeric'
	});
}
---

<BaseLayout
	title="Projets" 
	description="Découvrez mes projets en gestion de projet télécom, développement web, qualité et formation. Portfolio de réalisations professionnelles."
	customClass="bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800"
>
	<!-- En-tête de page -->
	<section class="py-16 md:py-24 bg-gradient-to-r from-indigo-600/5 to-violet-600/5 w-screen" style="margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw);">
		<div class="content-container text-center">
			<h1 class="text-4xl md:text-5xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-500">
				Mes Projets
				</h1>
			<p class="text-xl text-[#111827] dark:text-gray-200 mb-6">
				Une sélection de mes réalisations en gestion de projet, développement web et optimisation des processus
			</p>
			<div class="flex flex-wrap justify-center gap-3 mb-8">
				<span class="px-4 py-2 rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">Gestion de Projet</span>
				<span class="px-4 py-2 rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">Développement Web</span>
				<span class="px-4 py-2 rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300">Qualité & Process</span>
				<span class="px-4 py-2 rounded-full bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300">Formation</span>
				<span class="px-4 py-2 rounded-full bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300">Développement Commercial</span>
			</div>
		</div>
	</section>

	<!-- Section Domaines d'Expertise -->
	<main class="py-20 bg-gray-50 dark:bg-gray-900">
		<div class="content-container">
			<div class="text-center mb-16">
				<h2 class="text-4xl font-bold text-[#111827] dark:text-white mb-4">
					Domaines d'Expertise
			</h2>
				<p class="text-xl text-[#111827] dark:text-gray-300 max-w-3xl mx-auto">
					Découvrez mes compétences dans 5 domaines clés, chacun représentant une expertise spécifique
				</p>
			</div>
			
									<!-- Ligne 1: 3 cartes occupant 80% de la largeur -->
			<div class="w-4/5 mx-auto mb-8">
				<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
					{Object.entries(projectCategories).slice(0, 3).map(([categoryKey, category]) => (
						<article class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 hover:transform hover:scale-[1.02] border border-gray-100 dark:border-gray-700 h-[420px]">
							<div class="flex flex-col items-center text-center h-full justify-between">
								<div class="flex flex-col items-center">
									<div class={`p-4 rounded-2xl ${category.colorClass} inline-flex items-center justify-center mb-5 shadow-md`}>
										<i class={`${category.icon} text-3xl`}></i>
									</div>
									<h3 class="text-xl font-bold text-[#111827] dark:text-white mb-4">{category.name}</h3>
									<p class="text-[#111827] dark:text-gray-300 mb-5 text-sm leading-relaxed">{category.description}</p>
									<div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 rounded-full mb-5">
										<p class="text-sm text-gray-600 dark:text-gray-400 font-medium">{roleByCategory[categoryKey as keyof typeof roleByCategory]}</p>
									</div>
								</div>
								<div class="flex flex-col items-center">
									<div class="flex flex-wrap justify-center gap-2 mb-5">
										{(groupedProjects[categoryKey][0]?.data.technologies ?? ['Leadership','Organisation','Planification']).slice(0,3).map((pill: string) => (
											<span class="px-2 py-1 text-xs font-medium bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 rounded-full">{pill}</span>
										))}
									</div>
									{groupedProjects[categoryKey].length > 0 ? (
										<a href={`/projets/${groupedProjects[categoryKey][0].slug}`} class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline font-medium text-sm">
											Voir le projet <i class="fas fa-arrow-right"></i>
										</a>
									) : (
										<a href="#" class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 opacity-70 cursor-not-allowed text-sm">
											Bientôt disponible
										</a>
									)}
								</div>
							</div>
						</article>
					))}
				</div>
			</div>
			
			<!-- Ligne 2: 2 cartes se répartissant l'espace restant -->
			<div class="w-4/5 mx-auto">
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					{Object.entries(projectCategories).slice(3, 5).map(([categoryKey, category]) => (
						<article class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 hover:transform hover:scale-[1.02] border border-gray-100 dark:border-gray-700 h-[420px]">
							<div class="flex flex-col items-center text-center h-full justify-between">
								<div class="flex flex-col items-center">
									<div class={`p-4 rounded-2xl ${category.colorClass} inline-flex items-center justify-center mb-5 shadow-md`}>
										<i class={`${category.icon} text-3xl`}></i>
									</div>
									<h3 class="text-xl font-bold text-[#111827] dark:text-white mb-4">{category.name}</h3>
									<p class="text-[#111827] dark:text-gray-300 mb-5 text-sm leading-relaxed">{category.description}</p>
									<div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 rounded-full mb-5">
										<p class="text-sm text-gray-600 dark:text-gray-400 font-medium">{roleByCategory[categoryKey as keyof typeof roleByCategory]}</p>
									</div>
								</div>
								<div class="flex flex-col items-center">
									<div class="flex flex-wrap justify-center gap-2 mb-5">
										{(groupedProjects[categoryKey][0]?.data.technologies ?? ['Stratégie','Relation client','Négociation']).slice(0,3).map((pill: string) => (
											<span class="px-2 py-1 text-xs font-medium bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 rounded-full">{pill}</span>
										))}
									</div>
									{groupedProjects[categoryKey].length > 0 ? (
										<a href={`/projets/${groupedProjects[categoryKey][0].slug}`} class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline font-medium text-sm">
											Voir le projet <i class="fas fa-arrow-right"></i>
										</a>
									) : (
										<a href="#" class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 opacity-70 cursor-not-allowed text-sm">
											Bientôt disponible
										</a>
									)}
								</div>
							</div>
						</article>
					))}
				</div>
			</div>
		</div>
	</main>

	<!-- Call-to-action -->
	<section class="py-16 bg-white dark:bg-gray-800">
		<div class="content-container">
			<div class="bg-gradient-to-r from-indigo-600 to-violet-600 rounded-xl text-white text-center p-12">
				<h2 class="text-3xl font-bold mb-4">Envie de collaborer ?</h2>
				<p class="text-xl mb-8 opacity-90">
					Discutons de vos projets et voyons comment je peux vous aider à les concrétiser
				</p>
				<div class="flex flex-col sm:flex-row gap-4 justify-center">
					<a href="/contact" class="px-8 py-3 bg-white text-indigo-600 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
					Me contacter
				</a>
					<a href="/about" class="px-8 py-3 border-2 border-white text-white rounded-lg font-semibold hover:bg-white hover:text-indigo-600 transition-colors">
						En savoir plus
					</a>
				</div>
			</div>
		</div>
	</section>
</BaseLayout>

	<script>
		// Chargement de FontAwesome si pas déjà présent
	if (!document.querySelector('#font-awesome')) {
		const link = document.createElement('link');
			link.rel = 'stylesheet';
		link.id = 'font-awesome';
		link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
		document.head.appendChild(link);
	}
</script>

<style>
	/* Styles cohérents avec le design system */
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	
	/* Responsive */
	@media (max-width: 768px) {
		.content-container {
			padding: 0 1rem;
		}
		
		section {
			padding: 1.5rem;
		}
	}
</style> 