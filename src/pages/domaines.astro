---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import SearchBar from '../components/SearchBar.astro';

// R√©cup√©rer tous les articles
const allArticles = await getCollection('articles');

// Fonction pour obtenir TOUS les articles d'un domaine
function getAllArticlesForDomain(domain: string) {
  return allArticles.filter(article => {
    const articlePath = article.id;
    return articlePath.includes(domain);
  }).sort((a, b) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime();
  });
}

// Configuration des domaines avec ic√¥nes sp√©cialis√©es
const domainesConfig = {
  'gestion-projet': {
    name: 'Gestion de Projet T√©l√©com',
    description: 'M√©thodologies, outils et bonnes pratiques pour la gestion de projet',
    icon: 'fas fa-project-diagram',
    color: 'blue',
    gradient: 'from-blue-600 to-blue-500',
    bgColor: 'bg-blue-600 dark:bg-blue-500'
  },
  'developpement-web': {
    name: 'D√©veloppement Web',
    description: 'Tendances, technologies et bonnes pratiques du d√©veloppement web moderne',
    icon: 'fas fa-code-branch',
    color: 'green',
    gradient: 'from-green-600 to-green-500',
    bgColor: 'bg-green-600 dark:bg-green-500'
  },
  'qualite-process': {
    name: 'Qualit√© & Processus',
    description: 'Am√©lioration continue, certification et optimisation des processus',
    icon: 'fas fa-award',
    color: 'purple',
    gradient: 'from-purple-600 to-purple-500',
    bgColor: 'bg-purple-600 dark:bg-purple-500'
  },
  'formation': {
    name: 'Formation & P√©dagogie',
    description: 'Articles sur la formation, le d√©veloppement des comp√©tences et l\'apprentissage continu',
    icon: 'fas fa-book-open',
    color: 'red',
    gradient: 'from-red-600 to-red-500',
    bgColor: 'bg-red-600 dark:bg-red-500'
  },
  'developpement-commercial': {
    name: 'D√©veloppement Commercial',
    description: 'Strat√©gies commerciales, n√©gociation et d√©veloppement de partenariats',
    icon: 'fas fa-chart-line',
    color: 'orange',
    gradient: 'from-orange-600 to-orange-500',
    bgColor: 'bg-orange-600 dark:bg-orange-500'
  },
  'gestion-talents': {
    name: 'Gestion des Talents',
    description: 'Strat√©gies et m√©thodes pour g√©rer, d√©velopper et fid√©liser les talents',
    icon: 'fas fa-user-friends',
    color: 'teal',
    gradient: 'from-teal-600 to-teal-500',
    bgColor: 'bg-teal-600 dark:bg-teal-500'
  },
  'productivite-methodes': {
    name: 'Productivit√© & M√©thodes',
    description: 'Techniques et outils pour optimiser la productivit√© et l\'efficacit√©',
    icon: 'fas fa-rocket',
    color: 'indigo',
    gradient: 'from-indigo-600 to-indigo-500',
    bgColor: 'bg-indigo-600 dark:bg-indigo-500'
  },
  'transformation-digitale': {
    name: 'Transformation Digitale',
    description: 'Strat√©gies et enjeux de la transformation num√©rique des entreprises',
    icon: 'fas fa-microchip',
    color: 'pink',
    gradient: 'from-pink-600 to-pink-500',
    bgColor: 'bg-pink-600 dark:bg-pink-500'
  },
  'marketing-communication': {
    name: 'Marketing & Communication',
    description: 'Strat√©gies marketing, communication digitale et branding',
    icon: 'fas fa-bullhorn',
    color: 'yellow',
    gradient: 'from-yellow-600 to-yellow-500',
    bgColor: 'bg-yellow-600 dark:bg-yellow-500'
  },
  'leadership-management': {
    name: 'Leadership & Management',
    description: 'Techniques de leadership, management d\'√©quipe et d√©veloppement personnel',
    icon: 'fas fa-crown',
    color: 'purple',
    gradient: 'from-purple-600 to-purple-500',
    bgColor: 'bg-purple-600 dark:bg-purple-500'
  },
  'innovation-technologies': {
    name: 'Innovation & Technologies',
    description: 'Tendances technologiques, innovation et transformation digitale',
    icon: 'fas fa-brain',
    color: 'cyan',
    gradient: 'from-cyan-600 to-cyan-500',
    bgColor: 'bg-cyan-600 dark:bg-cyan-500'
  },
  'service-client': {
    name: 'Service Client',
    description: 'Excellence du service client, satisfaction et fid√©lisation',
    icon: 'fas fa-concierge-bell',
    color: 'emerald',
    gradient: 'from-emerald-600 to-emerald-500',
    bgColor: 'bg-emerald-600 dark:bg-emerald-500'
  },
  'gestion-connaissances': {
    name: 'Gestion des Connaissances',
    description: 'Capitalisation et partage des connaissances organisationnelles',
    icon: 'fas fa-database',
    color: 'violet',
    gradient: 'from-violet-600 to-violet-500',
    bgColor: 'bg-violet-600 dark:bg-violet-500'
  },
  'reconversion-carriere': {
    name: 'Reconversion & Carri√®re',
    description: 'Strat√©gies de reconversion professionnelle et √©volution de carri√®re',
    icon: 'fas fa-route',
    color: 'rose',
    gradient: 'from-rose-600 to-rose-500',
    bgColor: 'bg-rose-600 dark:bg-rose-500'
  },
  'outils-techniques': {
    name: 'Outils Techniques',
    description: 'Outils et technologies pour optimiser les processus m√©tier',
    icon: 'fas fa-cogs',
    color: 'slate',
    gradient: 'from-slate-600 to-slate-500',
    bgColor: 'bg-slate-600 dark:bg-slate-500'
  }
};

// Obtenir les domaines avec des articles
const domainesAvecArticles = Object.keys(domainesConfig).map(domainKey => {
  const articles = getAllArticlesForDomain(domainKey);
  return {
    key: domainKey,
    config: domainesConfig[domainKey as keyof typeof domainesConfig],
    articles: articles,
    totalArticles: articles.length
  };
}).filter(domaine => domaine.totalArticles > 0);
---

<BaseLayout title="Domaines d'Expertise" description="Explorez nos domaines d'expertise et d√©couvrez nos articles sp√©cialis√©s par th√©matique">
  <div class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
    <!-- Hero Section -->
    <div class="relative overflow-hidden bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600">
      <div class="absolute inset-0 bg-black/20"></div>
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
        <div class="text-center">
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-6">
            Domaines d'Expertise
          </h1>
          <p class="text-xl md:text-2xl text-indigo-100 mb-8 max-w-3xl mx-auto">
            Explorez nos domaines d'expertise et d√©couvrez nos articles sp√©cialis√©s par th√©matique
          </p>
          <div class="flex flex-wrap justify-center gap-4 text-sm text-indigo-200 mb-8">
            <span class="flex items-center">
              <i class="fas fa-book mr-2"></i>
              {allArticles.length} articles
            </span>
            <span class="flex items-center">
              <i class="fas fa-layer-group mr-2"></i>
              {domainesAvecArticles.length} domaines
            </span>
            <span class="flex items-center">
              <i class="fas fa-star mr-2"></i>
              Expertise confirm√©e
            </span>
          </div>
          
          <!-- Barre de recherche personnalis√©e -->
          <div class="max-w-2xl mx-auto mb-8">
            <div class="search-container mb-8">
              <div class="relative">
                <input
                  type="text"
                  id="searchInput"
                  class="w-full px-4 py-3 pl-12 rounded-lg bg-white/90 dark:bg-gray-800/90 border border-white/20 dark:border-gray-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-white/50 text-gray-800 dark:text-white backdrop-blur-sm"
                  placeholder="Rechercher dans les domaines et articles..."
                  aria-label="Rechercher"
                />
                <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                </div>
        <button
          id="clearSearch"
          class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
          aria-label="Effacer la recherche"
          style="display: none;"
        >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
              <div class="flex flex-wrap gap-2 mt-2" id="activeFilters"></div>
            </div>
          </div>
          

          <!-- Pills de navigation des domaines -->
          <div class="mt-8">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 text-center">Filtrer par domaine d'expertise</h3>
            <div class="flex flex-wrap justify-center gap-3 max-w-6xl mx-auto">
            {domainesAvecArticles.map((domaine) => {
              const colorClasses = {
                'blue': 'bg-gradient-to-r from-blue-600 to-blue-500',
                'green': 'bg-gradient-to-r from-green-600 to-green-500',
                'purple': 'bg-gradient-to-r from-purple-600 to-purple-500',
                'red': 'bg-gradient-to-r from-red-600 to-red-500',
                'orange': 'bg-gradient-to-r from-orange-600 to-orange-500',
                'teal': 'bg-gradient-to-r from-teal-600 to-teal-500',
                'indigo': 'bg-gradient-to-r from-indigo-600 to-indigo-500',
                'pink': 'bg-gradient-to-r from-pink-600 to-pink-500',
                'yellow': 'bg-gradient-to-r from-yellow-600 to-yellow-500',
                'cyan': 'bg-gradient-to-r from-cyan-600 to-cyan-500',
                'emerald': 'bg-gradient-to-r from-emerald-600 to-emerald-500',
                'violet': 'bg-gradient-to-r from-violet-600 to-violet-500',
                'rose': 'bg-gradient-to-r from-rose-600 to-rose-500',
                'slate': 'bg-gradient-to-r from-slate-600 to-slate-500'
              };
              
              return (
                <button 
                    class={`domain-filter-pill px-4 py-2 rounded-full text-white font-medium text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg transform-gpu ${colorClasses[domaine.config.color as keyof typeof colorClasses] || 'bg-gradient-to-r from-gray-600 to-gray-500'}`}
                  data-domain={domaine.key}
                    data-articles={JSON.stringify(domaine.articles)}
                  >
                    <i class={`${domaine.config.icon} mr-2`}></i>
                    {domaine.config.name}
                    <span class="ml-2 px-2 py-1 bg-white/30 rounded-full text-xs font-bold">
                    {domaine.totalArticles}
                  </span>
                </button>
              );
            })}
          </div>

            <!-- Conteneur pour le filtre actif -->
            <div id="activeDomainFilter" class="mt-4 text-center">
              <!-- Le filtre actif sera affich√© ici -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contenu des domaines - 3 par ligne -->
    <div id="domainesContainer" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {domainesAvecArticles.map((domaine, index) => (
          <div class="domain-section-3d bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transform-gpu transition-all duration-700 hover:scale-105 hover:rotate-1 hover:shadow-3xl hover:-translate-y-2" data-domain={domaine.key} data-index={index} style="transform-style: preserve-3d; perspective: 1000px; display: block;">
            <!-- En-t√™te du domaine -->
            <div class={`p-6 text-white ${domaine.config.color === 'blue' ? 'bg-gradient-to-r from-blue-600 to-blue-500' : 
              domaine.config.color === 'green' ? 'bg-gradient-to-r from-green-600 to-green-500' :
              domaine.config.color === 'purple' ? 'bg-gradient-to-r from-purple-600 to-purple-500' :
              domaine.config.color === 'red' ? 'bg-gradient-to-r from-red-600 to-red-500' :
              domaine.config.color === 'orange' ? 'bg-gradient-to-r from-orange-600 to-orange-500' :
              domaine.config.color === 'teal' ? 'bg-gradient-to-r from-teal-600 to-teal-500' :
              domaine.config.color === 'indigo' ? 'bg-gradient-to-r from-indigo-600 to-indigo-500' :
              domaine.config.color === 'pink' ? 'bg-gradient-to-r from-pink-600 to-pink-500' :
              domaine.config.color === 'yellow' ? 'bg-gradient-to-r from-yellow-600 to-yellow-500' :
              domaine.config.color === 'cyan' ? 'bg-gradient-to-r from-cyan-600 to-cyan-500' :
              domaine.config.color === 'emerald' ? 'bg-gradient-to-r from-emerald-600 to-emerald-500' :
              domaine.config.color === 'violet' ? 'bg-gradient-to-r from-violet-600 to-violet-500' :
              domaine.config.color === 'rose' ? 'bg-gradient-to-r from-rose-600 to-rose-500' :
              domaine.config.color === 'slate' ? 'bg-gradient-to-r from-slate-600 to-slate-500' :
              'bg-gradient-to-r from-gray-600 to-gray-500'}`}>
              <div class="flex items-center mb-4">
                <i class={`${domaine.config.icon} text-3xl mr-4`}></i>
                <div>
                  <h2 class="text-xl font-bold mb-1">{domaine.config.name}</h2>
                  <p class="text-sm opacity-90">{domaine.config.description}</p>
                </div>
              </div>
              <div class="flex items-center text-sm opacity-80">
                <i class="fas fa-file-alt mr-2"></i>
                <span>{domaine.totalArticles} article{domaine.totalArticles > 1 ? 's' : ''}</span>
              </div>
            </div>

            <!-- Articles du domaine -->
            <div class="p-6">
              <div class="space-y-4">
                <!-- Articles visibles (2 premiers) -->
                <div class="articles-container">
                  {domaine.articles.slice(0, 2).map((article, articleIndex) => (
                    <article 
                      class="article-card-3d group bg-gray-50 dark:bg-gray-700 rounded-xl p-4 hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 hover:rotate-1 hover:scale-105 transform-gpu cursor-pointer" 
                      style="transform-style: preserve-3d; pointer-events: auto !important;"
                      data-article-slug={article.slug}
                      data-article-href={`/blog/${article.slug}`}
                    >
                      <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-2">
                          <span class={`px-2 py-1 text-xs font-medium rounded-full ${domaine.config.bgColor} text-white`}>
                            {(article.data as any).pillColor || 'gray'}
                          </span>
                          {article.data.featured && (
                            <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">
                              Featured
                            </span>
                          )}
                        </div>
                        <span class="text-xs text-gray-500 dark:text-gray-400">
                          {article.data.readingTime} min
                        </span>
                      </div>
                      
                      <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                        {article.data.title}
                      </h3>
                      
                      <p class="text-gray-600 dark:text-gray-300 text-xs mb-3 line-clamp-2">
                        {article.data.description}
                      </p>
                      
                      <div class="flex items-center justify-between">
                        <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                          <i class="fas fa-calendar mr-1"></i>
                          <span>{new Date(article.data.publishDate).toLocaleDateString('fr-FR')}</span>
                        </div>
                        
                        <a 
                          href={`/blog/${article.slug}`}
                          class="inline-flex items-center px-3 py-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl text-xs"
                          style="z-index: 10; position: relative; pointer-events: auto !important; cursor: pointer !important;"
                          data-href={`/blog/${article.slug}`}
                        >
                          Lire
                          <i class="fas fa-arrow-right ml-1 text-xs"></i>
                        </a>
                      </div>
                    </article>
                  ))}
                </div>
                
                <!-- Boutons de contr√¥le si plus de 2 articles -->
                {domaine.totalArticles > 2 && (
                  <div class="text-center pt-4 space-y-2">
                    <button 
                      class="load-more-btn-3d load-more-btn inline-flex items-center px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-500 shadow-lg hover:shadow-2xl hover:scale-110 hover:rotate-2 hover:-translate-y-1 text-sm transform-gpu"
                      data-domain={domaine.key}
                      data-loaded="2"
                      data-articles={JSON.stringify(domaine.articles)}
                    >
                      <i class="fas fa-plus mr-2"></i>
                      En voir plus ({domaine.totalArticles - 2} autres)
                    </button>
                    
                    <button 
                      class="reduce-btn inline-flex items-center px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white font-medium rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-200 shadow-lg hover:shadow-xl text-sm"
                      style="display: none;"
                      data-domain={domaine.key}
                    >
                      <i class="fas fa-minus mr-2"></i>
                      R√©duire
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</BaseLayout>

<script>
    // Gestion des pills de navigation
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM charg√©, initialisation...');
      
      // Syst√®me de filtrage par domaines
      let activeDomain: string | null = null;
      
      // Gestionnaire de clic pour les pills de domaines
      document.addEventListener('click', function(e) {
        const target = e.target as HTMLElement;
        if (target.classList.contains('domain-filter-pill') || target.closest('.domain-filter-pill')) {
          const pill = target.classList.contains('domain-filter-pill') ? target : target.closest('.domain-filter-pill') as HTMLElement;
          if (!pill) return;
          
          const domain = pill.dataset.domain;
          if (!domain) return;
          const articles = JSON.parse(pill.dataset.articles || '[]');
          
          console.log('Domaine s√©lectionn√©:', domain, 'Articles:', articles.length);
          
          // Toggle du filtre
          if (activeDomain === domain) {
            // D√©sactiver le filtre
            activeDomain = null;
            pill.classList.remove('ring-4', 'ring-white', 'ring-opacity-50', 'scale-110');
            showAllDomains();
          } else {
            // Activer le filtre
            activeDomain = domain;
            
            // Retirer l'effet actif des autres pills
            document.querySelectorAll('.domain-filter-pill').forEach(p => {
              p.classList.remove('ring-4', 'ring-white', 'ring-opacity-50', 'scale-110');
            });
            
            // Ajouter l'effet actif √† la pill cliqu√©e
            pill.classList.add('ring-4', 'ring-white', 'ring-opacity-50', 'scale-110');
            
            // Filtrer par domaine
            filterByDomain(domain, articles);
          }
        }
      });
      
      // Fonction pour filtrer par domaine
      function filterByDomain(domain: string, articles: any[]) {
        const domainesContainer = document.getElementById('domainesContainer');
        if (!domainesContainer) return;
        
        // Masquer toutes les sections
        const allSections = domainesContainer.querySelectorAll('.domain-section-3d');
        console.log('Masquage de', allSections.length, 'sections');
        allSections.forEach(section => {
          (section as HTMLElement).style.display = 'none';
        });
        
        // Afficher seulement la section du domaine s√©lectionn√©
        const targetSection = domainesContainer.querySelector(`[data-domain="${domain}"]`);
        console.log('Section cible trouv√©e:', targetSection, 'pour le domaine:', domain);
        if (targetSection) {
          (targetSection as HTMLElement).style.display = 'block';
          (targetSection as HTMLElement).style.visibility = 'visible';
          (targetSection as HTMLElement).style.opacity = '1';
          console.log('Section affich√©e pour le domaine:', domain);
          
          // D√©placer la section en haut du conteneur
          domainesContainer.insertBefore(targetSection, domainesContainer.firstChild);
          
          // Mettre √† jour les articles de cette section
          const articlesContainer = targetSection.querySelector('.articles-container');
          const loadMoreBtn = targetSection.querySelector('.load-more-btn');
          
          if (articlesContainer) {
            console.log('Conteneur d\'articles trouv√©:', articlesContainer);
            
            // V√©rifier si le conteneur a d√©j√† des articles (articles initiaux)
            const existingArticles = articlesContainer.querySelectorAll('article');
            console.log('Articles existants dans le conteneur:', existingArticles.length);
            
            if (existingArticles.length === 0 && articles.length > 0) {
              // Si pas d'articles et qu'on a des articles √† afficher, les cr√©er
              console.log('Cr√©ation de', articles.length, 'articles');
              const articlesToShow = articles.slice(0, 2); // Afficher les 2 premiers par d√©faut
              articlesToShow.forEach((article: any) => {
              const articleEl = createArticleElement(article, domain);
                articlesContainer.appendChild(articleEl);
              });
            } else if (existingArticles.length > 0) {
              // Si des articles existent d√©j√†, s'assurer qu'ils sont visibles
              console.log('Rendre', existingArticles.length, 'articles existants visibles');
              existingArticles.forEach((article, idx) => {
                (article as HTMLElement).style.display = 'block';
                (article as HTMLElement).style.visibility = 'visible';
                (article as HTMLElement).style.opacity = '1';
                console.log(`Article ${idx} rendu visible`);
              });
            }
            
            // Mettre √† jour le bouton "En voir plus" si n√©cessaire
            if (loadMoreBtn) {
              if (articles.length > 2) {
          (loadMoreBtn as HTMLElement).style.display = 'block';
          (loadMoreBtn as HTMLElement).dataset.articles = JSON.stringify(articles);
                (loadMoreBtn as HTMLElement).dataset.loaded = existingArticles.length > 0 ? existingArticles.length.toString() : '2';
          (loadMoreBtn as HTMLElement).dataset.expanded = 'false';
                const remaining = articles.length - (existingArticles.length > 0 ? existingArticles.length : 2);
                (loadMoreBtn as HTMLElement).innerHTML = `<i class="fas fa-plus mr-2"></i>En voir plus (${remaining} autres)`;
          
          // Ajouter un gestionnaire d'√©v√©nements direct
          (loadMoreBtn as HTMLElement).onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Bouton "En voir plus" cliqu√© directement');
            handleLoadMoreClick(loadMoreBtn as HTMLElement);
          };
              } else {
                (loadMoreBtn as HTMLElement).style.display = 'none';
              }
          
              // R√©initialiser les gestionnaires d'√©v√©nements des articles
          setTimeout(() => {
                const allArticlesInContainer = articlesContainer.querySelectorAll('article');
                console.log('R√©initialisation de', allArticlesInContainer.length, 'articles');
                allArticlesInContainer.forEach((article, idx) => {
                  // S'assurer que l'article est visible
                  (article as HTMLElement).style.display = 'block';
                  (article as HTMLElement).style.visibility = 'visible';
                  (article as HTMLElement).style.opacity = '1';
                  (article as HTMLElement).style.position = 'relative';
                  
                  // R√©cup√©rer le slug depuis l'attribut data
                  const slug = article.getAttribute('data-article-slug');
                  console.log(`Article ${idx} - Slug:`, slug);
                  
                  // Rendre toute la carte cliquable MAIS ne pas bloquer les liens
                  (article as HTMLElement).style.cursor = 'pointer';
                  (article as HTMLElement).onclick = function(e) {
                    // Si on clique sur un lien, ne RIEN faire - laisser le comportement par d√©faut
                    if ((e.target as HTMLElement).tagName === 'A' || (e.target as HTMLElement).closest('a')) {
                      return true; // Laisser le lien fonctionner normalement
                    }
                    // Si on clique ailleurs sur la carte (pas sur un lien), naviguer
                    if (slug) {
                      console.log(`üì¶ Carte article ${idx} cliqu√©e (pas sur lien), navigation vers:`, `/blog/${slug}`);
                      window.location.href = `/blog/${slug}`;
                      return false;
                    }
                    return true;
                  };
                  
                  // R√©cup√©rer et forcer le bouton "Lire"
                  const readButton = article.querySelector('a[href*="/blog/"]') as HTMLAnchorElement;
                  if (readButton) {
                    const href = readButton.getAttribute('href') || readButton.href || (slug ? `/blog/${slug}` : '');
                    console.log(`Article ${idx} - Bouton Lire trouv√©:`, href);
                    
                    // S'assurer que le href est correct
                    readButton.href = href;
                    readButton.setAttribute('href', href);
                    
                    // SUPPRIMER TOUS les gestionnaires qui bloquent
                    readButton.onclick = null;
                    readButton.removeAttribute('onclick');
                    
                    // Supprimer tous les anciens listeners en clonant
                    const cleanButton = readButton.cloneNode(true) as HTMLAnchorElement;
                    readButton.parentNode?.replaceChild(cleanButton, readButton);
                    
                    cleanButton.href = href;
                    cleanButton.setAttribute('href', href);
                    cleanButton.style.pointerEvents = 'auto';
                    cleanButton.style.cursor = 'pointer';
                    cleanButton.style.zIndex = '1000';
                    cleanButton.style.position = 'relative';
                    
                    // Handler minimal qui NE BLOQUE PAS la navigation
                    cleanButton.addEventListener('click', function(e) {
                      console.log(`üîó Bouton "Lire" de l'article ${idx} cliqu√©:`, href);
                      // NE PAS appeler preventDefault - laisser le comportement par d√©faut
                    }, false);
                  } else {
                    console.warn(`‚ö†Ô∏è Pas de bouton "Lire" trouv√© pour l'article ${idx}`);
                  }
                });
                
                // Tester la visibilit√© des articles
                console.log('üìä Test de visibilit√© des articles:');
                allArticlesInContainer.forEach((article, idx) => {
                  const rect = (article as HTMLElement).getBoundingClientRect();
                  const styles = window.getComputedStyle(article as HTMLElement);
                  console.log(`Article ${idx}:`, {
                    visible: rect.width > 0 && rect.height > 0,
                    display: styles.display,
                    visibility: styles.visibility,
                    opacity: styles.opacity,
                    position: rect.top,
                    width: rect.width,
                    height: rect.height
                  });
                });
                
                // Forcer aussi avec la fonction forceAllArticleLinks
                setTimeout(() => {
                  const forceLinks = document.querySelectorAll('a[href*="/blog/"]');
                  console.log('üîß For√ßage de', forceLinks.length, 'liens apr√®s r√©initialisation');
                  
                  // Test direct : ajouter un clic de test sur le premier bouton
                  if (forceLinks.length > 0) {
                    const firstLink = forceLinks[0] as HTMLAnchorElement;
                    console.log('üß™ Test du premier lien:', firstLink.href, firstLink);
                    console.log('üß™ Premier lien onclick:', firstLink.onclick);
                    console.log('üß™ Premier lien listeners:', firstLink.addEventListener);
              }
                }, 50);
          }, 100);
        }
          }
        }
        
        // Mettre √† jour le filtre actif
        updateActiveDomainFilter(domain);
        
        // Faire d√©filer vers la section
        if (targetSection) {
          targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
      
      // Fonction pour afficher tous les domaines
      function showAllDomains() {
        const domainesContainer = document.getElementById('domainesContainer');
        if (!domainesContainer) return;
        
        const allSections = domainesContainer.querySelectorAll('.domain-section-3d');
        allSections.forEach(section => {
          (section as HTMLElement).style.display = 'block';
        });
        
        // Restaurer l'ordre original des sections
        const sectionsArray = Array.from(allSections);
        sectionsArray.sort((a, b) => {
          const aIndex = parseInt((a as HTMLElement).dataset.index || '0');
          const bIndex = parseInt((b as HTMLElement).dataset.index || '0');
          return aIndex - bIndex;
        });
        
        sectionsArray.forEach(section => {
          domainesContainer.appendChild(section);
        });
        
        // Effacer le filtre actif
        updateActiveDomainFilter(null);
      }
      
      // Fonction pour mettre √† jour le filtre actif
      function updateActiveDomainFilter(domain: string | null) {
        const activeFilterContainer = document.getElementById('activeDomainFilter');
        if (!activeFilterContainer) return;
        
        activeFilterContainer.innerHTML = '';
        
        if (domain) {
          // Configuration des domaines (copie locale)
          const domainConfigs: Record<string, { name: string; icon: string }> = {
            'gestion-projet': { name: 'Gestion de Projet T√©l√©com', icon: 'fas fa-project-diagram' },
            'developpement-web': { name: 'D√©veloppement Web', icon: 'fas fa-code-branch' },
            'qualite-process': { name: 'Qualit√© & Processus', icon: 'fas fa-award' },
            'formation': { name: 'Formation & P√©dagogie', icon: 'fas fa-book-open' },
            'developpement-commercial': { name: 'D√©veloppement Commercial', icon: 'fas fa-chart-line' },
            'gestion-talents': { name: 'Gestion des Talents', icon: 'fas fa-user-friends' },
            'productivite-methodes': { name: 'Productivit√© & M√©thodes', icon: 'fas fa-rocket' },
            'transformation-digitale': { name: 'Transformation Digitale', icon: 'fas fa-microchip' },
            'marketing-communication': { name: 'Marketing & Communication', icon: 'fas fa-bullhorn' },
            'leadership-management': { name: 'Leadership & Management', icon: 'fas fa-crown' },
            'innovation-technologies': { name: 'Innovation & Technologies', icon: 'fas fa-brain' },
            'service-client': { name: 'Service Client', icon: 'fas fa-concierge-bell' },
            'gestion-connaissances': { name: 'Gestion des Connaissances', icon: 'fas fa-database' },
            'reconversion-carriere': { name: 'Reconversion & Carri√®re', icon: 'fas fa-route' },
            'outils-techniques': { name: 'Outils Techniques', icon: 'fas fa-cogs' }
          };
          
          const domainConfig = domainConfigs[domain];
          if (domainConfig) {
            const filterEl = document.createElement('div');
            filterEl.className = 'inline-flex items-center px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-full text-sm font-medium shadow-lg';
            filterEl.innerHTML = `
              <i class="${domainConfig.icon} mr-2"></i>
              ${domainConfig.name}
              <button class="ml-2 text-white hover:text-indigo-200 transition-colors" onclick="clearDomainFilter()">
                <i class="fas fa-times"></i>
              </button>
            `;
            activeFilterContainer.appendChild(filterEl);
          }
        }
      }
      
      // Fonction globale pour effacer le filtre
      (window as any).clearDomainFilter = function() {
        activeDomain = null;
        document.querySelectorAll('.domain-filter-pill').forEach(pill => {
          pill.classList.remove('ring-4', 'ring-white', 'ring-opacity-50', 'scale-110');
        });
        showAllDomains();
      };


    // Initialisation des boutons "En voir plus"
    function initializeLoadMoreButtons() {
      const loadMoreBtns = document.querySelectorAll('.load-more-btn');
      loadMoreBtns.forEach((btn: Element) => {
        const btnElement = btn as HTMLElement;
        if (!btnElement.dataset.expanded) {
          btnElement.dataset.expanded = 'false';
        }
        if (!btnElement.dataset.loaded) {
          btnElement.dataset.loaded = '2';
        }
        
        // Ajouter un gestionnaire d'√©v√©nements direct
        btnElement.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Bouton "En voir plus" initialis√© cliqu√©');
          handleLoadMoreClick(btnElement);
        };
        
        console.log('Bouton initialis√©:', { 
          domain: btnElement.dataset.domain, 
          expanded: btnElement.dataset.expanded, 
          loaded: btnElement.dataset.loaded 
        });
      });
    }
    
    // Initialiser les boutons au chargement
    initializeLoadMoreButtons();
    
    // R√©initialiser les boutons apr√®s un d√©lai pour s'assurer que tous les √©l√©ments sont charg√©s
    setTimeout(() => {
      console.log('R√©initialisation des boutons apr√®s d√©lai');
      initializeLoadMoreButtons();
    }, 1000);
    
    // Fonction de test pour v√©rifier l'accord√©on
    function testAccordion() {
      const loadMoreBtns = document.querySelectorAll('.load-more-btn');
      console.log('Test de l\'accord√©on:', {
        nombreBoutons: loadMoreBtns.length,
        boutons: Array.from(loadMoreBtns).map(btn => ({
          domain: (btn as HTMLElement).dataset.domain,
          expanded: (btn as HTMLElement).dataset.expanded,
          loaded: (btn as HTMLElement).dataset.loaded,
          text: btn.textContent
        }))
      });
    }
    
    // Tester l'accord√©on apr√®s un d√©lai
    setTimeout(testAccordion, 1000);
    
    // Fonction de test pour v√©rifier les liens d'articles
    function testArticleLinks() {
      // Chercher les liens /blog/ ET /articles/
      const blogLinks = document.querySelectorAll('a[href*="/blog/"]');
      const articleLinks = document.querySelectorAll('a[href*="/articles/"]');
      const allArticleLinks = document.querySelectorAll('a[href*="/blog/"], a[href*="/articles/"]');
      
      console.log('Test des liens d\'articles:', {
        liensBlog: blogLinks.length,
        liensArticles: articleLinks.length,
        total: allArticleLinks.length,
        liens: Array.from(allArticleLinks).slice(0, 5).map(link => ({
          href: (link as HTMLAnchorElement).href,
          text: link.textContent?.trim()?.substring(0, 30)
        }))
      });
      
      // Ajouter des gestionnaires de test sur TOUS les liens d'articles
      allArticleLinks.forEach((link, index) => {
        link.addEventListener('click', function(e) {
          console.log(`üîó Lien ${index} cliqu√©:`, (e.target as HTMLAnchorElement).href);
          // Forcer la navigation si n√©cessaire
          const href = this.getAttribute('href');
          if (href && !href.startsWith('#')) {
            setTimeout(() => {
              if (window.location.pathname !== href) {
                console.log('‚ö†Ô∏è Navigation forc√©e vers:', href);
                window.location.href = href;
              }
            }, 100);
          }
        }, true);
      });
    }
    
    // Tester les liens apr√®s un d√©lai
    setTimeout(testArticleLinks, 1500);
      
      // Forcer la navigation sur TOUS les liens /blog/
      function forceAllArticleLinks() {
        const blogLinks = document.querySelectorAll('a[href*="/blog/"]');
        console.log(`üîß Initialisation de ${blogLinks.length} liens d'articles...`);
        
        blogLinks.forEach((link, index) => {
          const href = (link as HTMLAnchorElement).getAttribute('href') || (link as HTMLAnchorElement).href;
          if (href && href.includes('/blog/')) {
            // Supprimer TOUS les anciens gestionnaires en clonant
            const newLink = link.cloneNode(true) as HTMLAnchorElement;
            link.parentNode?.replaceChild(newLink, link);
            
            // S'assurer que le href est correct
            newLink.href = href;
            newLink.setAttribute('href', href);
            
            // Style pour s'assurer qu'il est cliquable
            newLink.style.pointerEvents = 'auto';
            newLink.style.cursor = 'pointer';
            newLink.style.zIndex = '1000';
            newLink.style.position = 'relative';
            
            // SUPPRIMER tous les gestionnaires pour utiliser le comportement par d√©faut
            newLink.removeAttribute('onclick');
            newLink.onclick = null;
            
            // Handler minimal qui NE BLOQUE PAS - juste pour d√©bogage
            newLink.addEventListener('click', function(e) {
              console.log(`üîó Lien ${index} cliqu√© (comportement par d√©faut):`, href);
              // NE PAS appeler preventDefault() - laisser le navigateur naviguer
            }, false);
            
            // Aussi rendre l'article parent cliquable si pr√©sent
            const article = newLink.closest('article.article-card-3d');
            if (article) {
              (article as HTMLElement).style.cursor = 'pointer';
              (article as HTMLElement).style.pointerEvents = 'auto';
              (article as HTMLElement).onclick = function(e) {
                if ((e.target as HTMLElement).tagName === 'A' || (e.target as HTMLElement).closest('a')) {
                  return; // Laisser le lien g√©rer son propre clic
                }
                const slug = article.getAttribute('data-article-slug');
                const articleHref = slug ? `/blog/${slug}` : href;
                console.log(`üì¶ Article parent du lien ${index} cliqu√©:`, articleHref);
                e.preventDefault();
                e.stopPropagation();
                window.location.href = articleHref;
                return false;
              };
            }
          }
        });
        
        console.log(`‚úÖ ${blogLinks.length} liens d'articles initialis√©s`);
      }
      
      // Initialiser imm√©diatement et apr√®s d√©lais
      setTimeout(forceAllArticleLinks, 500);
      setTimeout(forceAllArticleLinks, 1500);
      setTimeout(forceAllArticleLinks, 3000);
      
      // Fonction pour NETTOYER tous les gestionnaires qui bloquent
      function cleanAllArticleLinks() {
        const blogLinks = document.querySelectorAll('a[href*="/blog/"]');
        console.log(`üßπ Nettoyage de ${blogLinks.length} liens d'articles...`);
        
        blogLinks.forEach((link, index) => {
          const href = (link as HTMLAnchorElement).getAttribute('href') || (link as HTMLAnchorElement).href;
          if (href && href.includes('/blog/')) {
            // Cloner pour supprimer TOUS les gestionnaires
            const cleanLink = link.cloneNode(true) as HTMLAnchorElement;
            link.parentNode?.replaceChild(cleanLink, link);
            
            cleanLink.href = href;
            cleanLink.setAttribute('href', href);
            cleanLink.style.pointerEvents = 'auto';
            cleanLink.style.cursor = 'pointer';
            cleanLink.style.zIndex = '1000';
            cleanLink.style.position = 'relative';
            
            // Pas d'onclick, pas de preventDefault - comportement par d√©faut uniquement
            console.log(`‚úÖ Lien ${index} nettoy√©: ${href}`);
          }
        });
        
        console.log(`üßπ Nettoyage termin√© pour ${blogLinks.length} liens`);
      }
      
      // Nettoyer apr√®s que tous les autres scripts aient fini
      setTimeout(cleanAllArticleLinks, 2000);
      setTimeout(cleanAllArticleLinks, 4000);
      setTimeout(cleanAllArticleLinks, 6000);
      
      // Test final : v√©rifier que les liens fonctionnent et TESTER DIRECTEMENT
      setTimeout(() => {
        const testLinks = document.querySelectorAll('a[href*="/blog/"]');
        console.log('üß™ TEST FINAL - V√©rification des liens:', testLinks.length);
        testLinks.forEach((link, idx) => {
          const linkEl = link as HTMLAnchorElement;
          const href = linkEl.href;
          const hasOnclick = !!linkEl.onclick;
          
          // Afficher les infos du lien
          const displayHref = href.substring(href.indexOf('/blog/'));
          console.log(`  Lien ${idx}: ${displayHref}`);
          console.log(`    - onclick: ${hasOnclick ? 'OUI (PROBL√àME!)' : 'NON (OK)'}`);
          console.log(`    - pointer-events: ${getComputedStyle(linkEl).pointerEvents}`);
          console.log(`    - z-index: ${getComputedStyle(linkEl).zIndex}`);
          console.log(`    - position: ${getComputedStyle(linkEl).position}`);
          
          // Si un onclick existe, le supprimer FORTEMENT
          if (hasOnclick) {
            console.log(`  ‚ö†Ô∏è Suppression FORC√âE de l'onclick du lien ${idx}`);
            linkEl.onclick = null;
            linkEl.removeAttribute('onclick');
            
            // Cloner pour supprimer tous les listeners
            const cleanLink = linkEl.cloneNode(true) as HTMLAnchorElement;
            linkEl.parentNode?.replaceChild(cleanLink, linkEl);
            cleanLink.href = href;
            cleanLink.style.pointerEvents = 'auto';
            cleanLink.style.cursor = 'pointer';
          }
          
          // V√©rifier s'il y a un √©l√©ment qui bloque les clics au-dessus
          const rect = linkEl.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          const elementAtPoint = document.elementFromPoint(centerX, centerY);
          
          console.log(`  - √âl√©ment au centre du lien:`, elementAtPoint?.tagName, elementAtPoint?.className);
          if (elementAtPoint && elementAtPoint !== linkEl && !linkEl.contains(elementAtPoint)) {
            const blockingStyle = getComputedStyle(elementAtPoint as HTMLElement);
            console.log(`  ‚ö†Ô∏è √âL√âMENT BLOQUANT D√âTECT√â:`);
            console.log(`    - Tag: ${elementAtPoint.tagName}`);
            console.log(`    - Classe: ${(elementAtPoint as HTMLElement).className}`);
            console.log(`    - pointer-events: ${blockingStyle.pointerEvents}`);
            console.log(`    - z-index: ${blockingStyle.zIndex}`);
            console.log(`    - position: ${blockingStyle.position}`);
            
            // Si l'√©l√©ment bloque, essayer de le d√©sactiver
            if (blockingStyle.pointerEvents !== 'none' && elementAtPoint !== linkEl) {
              console.log(`  üîß Tentative de d√©sactivation de l'√©l√©ment bloquant...`);
              (elementAtPoint as HTMLElement).style.pointerEvents = 'none';
            }
          } else {
            console.log(`  ‚úÖ Aucun √©l√©ment bloquant d√©tect√©`);
          }
        });
        console.log('‚úÖ Test final termin√©');
        
        // Test : essayer de cliquer programmatiquement sur le premier lien
        if (testLinks.length > 0) {
          const firstLink = testLinks[0] as HTMLAnchorElement;
          console.log('üß™ Test de clic programmatique sur:', firstLink.href);
          
          // Ajouter des listeners sur TOUS les liens pour voir si les clics sont d√©tect√©s
          testLinks.forEach((link, idx) => {
            const linkEl = link as HTMLAnchorElement;
            
            // Listener simple pour d√©tecter les clics
            linkEl.addEventListener('click', function(e) {
              console.log(`üéØ CLIC D√âTECT√â sur lien ${idx}:`, linkEl.href);
              console.log(`  - Target:`, e.target);
              console.log(`  - CurrentTarget:`, e.currentTarget);
              
              // Ne PAS pr√©venir le comportement par d√©faut - laisser naviguer
              // e.preventDefault(); // NE PAS faire √ßa
            }, false);
            
            // Aussi en capture pour voir si √ßa passe
            linkEl.addEventListener('click', function(e) {
              console.log(`üéØ [CAPTURE] CLIC D√âTECT√â sur lien ${idx}:`, linkEl.href);
            }, true);
          });
          
          console.log('‚úÖ Listeners de test ajout√©s sur tous les liens');
          console.log('üëÜ MAINTENANT, CLIQUE SUR UN LIEN et regarde la console !');
        }
      }, 7000);
    
    // Fonction de d√©bogage globale
    function debugNavigation() {
      console.log('=== D√âBOGAGE NAVIGATION ===');
      
      // V√©rifier les liens existants
      const allLinks = document.querySelectorAll('a');
      console.log('Tous les liens:', allLinks.length);
      
      const blogLinks = document.querySelectorAll('a[href*="/blog/"]');
      const articleLinks = document.querySelectorAll('a[href*="/articles/"]');
      console.log('Liens /blog/:', blogLinks.length);
      console.log('Liens /articles/:', articleLinks.length);
      
      // V√©rifier les articles
      const articles = document.querySelectorAll('article');
      console.log('Articles trouv√©s:', articles.length);
      
      // Tester un clic sur le premier lien
      if (articleLinks.length > 0) {
        const firstLink = articleLinks[0] as HTMLAnchorElement;
        console.log('Premier lien:', firstLink.href);
        
        // Ajouter un test de clic
        firstLink.addEventListener('click', function(e) {
          console.log('TEST: Premier lien cliqu√©!', e.target);
        });
      }
    }
    
    // D√©boguer apr√®s 2 secondes
    setTimeout(debugNavigation, 2000);

    // Gestion du bouton "En voir +" / "R√©duire"
    document.addEventListener('click', function(e) {
      const target = e.target as HTMLElement;
      // Ne logger que les clics int√©ressants (pas les sections)
      if (!target.classList.contains('domain-section-3d') && !target.closest('.domain-section-3d')) {
        // console.log('Clic d√©tect√© sur:', target.tagName, target.className);
      }
      
      if (target.classList.contains('load-more-btn') || target.closest('.load-more-btn')) {
        const btn = target.classList.contains('load-more-btn') ? target : target.closest('.load-more-btn') as HTMLElement;
        if (!btn) return;
        
        console.log('Bouton "En voir plus" cliqu√©:', btn);
        
        const domain = btn.dataset.domain;
        const currentLoaded = parseInt(btn.dataset.loaded || '2');
        const articlesContainer = btn.parentElement?.previousElementSibling as HTMLElement;
        const allArticles = JSON.parse(btn.dataset.articles || '[]');
        const isExpanded = btn.dataset.expanded === 'true';
        
        console.log('Bouton cliqu√©:', { 
          domain, 
          currentLoaded, 
          allArticles: allArticles.length, 
          isExpanded,
          articlesContainer: !!articlesContainer,
          btnText: btn.textContent
        });
        
        if (isExpanded) {
          // R√©duire le domaine - afficher seulement les 2 premiers articles
          const firstTwoArticles = allArticles.slice(0, 2);
          if (articlesContainer) {
            articlesContainer.innerHTML = '';
            firstTwoArticles.forEach((article: any) => {
                const articleEl = createArticleElement(article, domain || '');
                articlesContainer.appendChild(articleEl);
              });
            }
            
          // Mettre √† jour le bouton
          btn.innerHTML = `<i class="fas fa-plus mr-2"></i>En voir plus (${allArticles.length - 2} autres)`;
          btn.dataset.loaded = '2';
          btn.dataset.expanded = 'false';
          
            } else {
          // Charger 3 articles suppl√©mentaires
          const newArticles = allArticles.slice(currentLoaded, currentLoaded + 3);
        
          console.log('Chargement des articles:', { newArticles: newArticles.length, currentLoaded });
          
          // Ajouter les nouveaux articles
          newArticles.forEach((article: any) => {
            const articleEl = createArticleElement(article, domain || '');
            articlesContainer?.appendChild(articleEl);
          });
        
          // Mettre √† jour le compteur
          const newLoaded = currentLoaded + 3;
          btn.dataset.loaded = newLoaded.toString();
          
          // V√©rifier s'il reste des articles
          const remaining = allArticles.length - newLoaded;
          if (remaining > 0) {
            btn.innerHTML = `<i class="fas fa-plus mr-2"></i>En voir plus (${remaining} autres)`;
            } else {
            // Tous les articles sont charg√©s, changer le bouton pour "R√©duire"
            btn.innerHTML = `<i class="fas fa-minus mr-2"></i>R√©duire`;
            btn.dataset.expanded = 'true';
          }
            }
          }
        });
        
    // Gestionnaire d'√©v√©nement global pour tous les articles
    // IMPORTANT: Ne JAMAIS bloquer les liens /blog/
    document.addEventListener('click', function(e) {
      const target = e.target as HTMLElement;
      
      // Si on clique directement sur un lien /blog/ ou √† l'int√©rieur d'un lien /blog/
      const clickedLink = target.tagName === 'A' ? target as HTMLAnchorElement : target.closest('a[href*="/blog/"]') as HTMLAnchorElement;
      if (clickedLink) {
        const href = clickedLink.getAttribute('href') || clickedLink.href;
        if (href && (href.includes('/blog/') || href.startsWith('/blog/'))) {
          console.log('üîó [GLOBAL] Lien /blog/ d√©tect√© - COMPORTEMENT PAR D√âFAUT AUTORIS√â:', href);
          // NE JAMAIS appeler preventDefault ou stopPropagation pour les liens /blog/
          // Laisser le navigateur g√©rer la navigation
          // Sortir imm√©diatement sans rien faire
        return;
      }
      }
      
      // Ignorer les clics sur les boutons de filtre
      if (target.classList.contains('domain-filter-pill') || target.closest('.domain-filter-pill')) {
        return;
      }
      
      // Ignorer les clics sur les sections de domaine elles-m√™mes (pas sur les articles √† l'int√©rieur)
      if (target.classList.contains('domain-section-3d')) {
        return; // Clic direct sur la section, ne rien faire
      }
      
      // Ignorer les clics sur les boutons "En voir plus"
      if (target.classList.contains('load-more-btn') || target.closest('.load-more-btn')) {
        return;
      }
      
      // Si on clique sur un article (mais pas sur un lien directement)
      const article = target.closest('article.article-card-3d');
      if (article) {
        // IMPORTANT: Si on clique sur un lien ou √† l'int√©rieur d'un lien, ne RIEN faire
        // Les liens g√®rent leurs propres clics
        if (target.tagName === 'A' || target.closest('a')) {
          return; // Laisser le lien fonctionner normalement
        }
        
        // V√©rifier qu'on ne clique pas sur la section de domaine
        const section = target.closest('.domain-section-3d');
        if (section && target === section) {
          return; // Clic sur la section, pas sur l'article
        }
        
        // Sinon, cliquer sur la carte = navigation vers l'article
        const slug = article.getAttribute('data-article-slug');
        const href = slug ? `/blog/${slug}` : null;
        
        if (href) {
          console.log('üì¶ Carte article cliqu√©e (pas sur lien), navigation vers:', href);
          e.preventDefault();
          e.stopPropagation();
          window.location.href = href;
          return false;
        }
        
        // Fallback : chercher le lien dans l'article
        const link = article.querySelector('a[href*="/blog/"]') as HTMLAnchorElement;
        if (link) {
          const linkHref = link.getAttribute('href') || link.href;
          console.log('üì¶ Article cliqu√© (fallback), redirection vers:', linkHref);
          e.preventDefault();
          e.stopPropagation();
          window.location.href = linkHref;
          return false;
        }
      }
    }, false); // Ne pas utiliser capture phase pour √©viter les conflits - les liens doivent fonctionner normalement
    
    // Fonction pour g√©rer les clics sur "En voir plus"
    function handleLoadMoreClick(btn: HTMLElement) {
      console.log('handleLoadMoreClick appel√©');
      const domain = btn.dataset.domain;
      const currentLoaded = parseInt(btn.dataset.loaded || '3');
      const articlesContainer = btn.parentElement?.previousElementSibling as HTMLElement;
      const allArticles = JSON.parse(btn.dataset.articles || '[]');
      const isExpanded = btn.dataset.expanded === 'true';
      
      console.log('Donn√©es du bouton:', { domain, currentLoaded, allArticles: allArticles.length, isExpanded });
      
      if (!articlesContainer) {
        console.error('Conteneur d\'articles non trouv√©');
        return;
      }
      
      if (isExpanded) {
        // R√©duire : afficher seulement les 3 premiers articles
        articlesContainer.innerHTML = '';
        const firstThree = allArticles.slice(0, 3);
        firstThree.forEach((article: any) => {
          const articleEl = createArticleElement(article, domain || '');
          articlesContainer.appendChild(articleEl);
        });
        
        btn.dataset.loaded = '3';
        btn.dataset.expanded = 'false';
        btn.innerHTML = `<i class="fas fa-plus mr-2"></i>En voir plus (${allArticles.length - 3} autres)`;
        console.log('Articles r√©duits √† 3');
      } else {
        // √âtendre : afficher tous les articles
        articlesContainer.innerHTML = '';
        allArticles.forEach((article: any) => {
          const articleEl = createArticleElement(article, domain || '');
          articlesContainer.appendChild(articleEl);
        });
        
        btn.dataset.loaded = allArticles.length.toString();
        btn.dataset.expanded = 'true';
        btn.innerHTML = `<i class="fas fa-minus mr-2"></i>R√©duire`;
        console.log('Tous les articles affich√©s');
      }
      
      // R√©initialiser les gestionnaires d'√©v√©nements des nouveaux articles
      setTimeout(() => {
        const newArticles = articlesContainer.querySelectorAll('article');
        newArticles.forEach(article => {
          const readButton = article.querySelector('a[href*="/blog/"]') as HTMLAnchorElement;
          if (readButton) {
            // NE PAS ajouter d'onclick - laisser le comportement par d√©faut du navigateur
            // S'assurer que le lien est cliquable
            readButton.style.pointerEvents = 'auto';
            readButton.style.cursor = 'pointer';
          }
        });
      }, 100);
    }

    // Fonction pour cr√©er un √©l√©ment d'article avec navigation fonctionnelle
    function createArticleElement(article: any, domain: string) {
      const domainConfig: Record<string, { bgColor: string; color: string }> = {
        'gestion-projet': { bgColor: 'bg-blue-600', color: 'blue' },
        'developpement-web': { bgColor: 'bg-green-600', color: 'green' },
        'qualite-process': { bgColor: 'bg-purple-600', color: 'purple' },
        'formation': { bgColor: 'bg-red-600', color: 'red' },
        'developpement-commercial': { bgColor: 'bg-orange-600', color: 'orange' },
        'gestion-talents': { bgColor: 'bg-teal-600', color: 'teal' },
        'productivite-methodes': { bgColor: 'bg-indigo-600', color: 'indigo' },
        'transformation-digitale': { bgColor: 'bg-pink-600', color: 'pink' },
        'marketing-communication': { bgColor: 'bg-yellow-600', color: 'yellow' },
        'leadership-management': { bgColor: 'bg-purple-600', color: 'purple' },
        'innovation-technologies': { bgColor: 'bg-cyan-600', color: 'cyan' },
        'service-client': { bgColor: 'bg-emerald-600', color: 'emerald' },
        'gestion-connaissances': { bgColor: 'bg-violet-600', color: 'violet' },
        'reconversion-carriere': { bgColor: 'bg-rose-600', color: 'rose' },
        'outils-techniques': { bgColor: 'bg-slate-600', color: 'slate' }
      };
      
      const currentDomainConfig = domainConfig[domain || ''] || { bgColor: 'bg-gray-600', color: 'gray' };
      
      const articleElement = document.createElement('article');
      articleElement.className = 'group bg-gray-50 dark:bg-gray-700 rounded-xl p-4 hover:shadow-lg hover:shadow-indigo-200 dark:hover:shadow-indigo-900 transition-all duration-300 hover:-translate-y-1 article-card-3d cursor-pointer border border-transparent hover:border-indigo-200 dark:hover:border-indigo-700';
      
      articleElement.innerHTML = `
        <div class="flex items-start justify-between mb-3">
          <div class="flex items-center space-x-2">
            <span class="px-2 py-1 text-xs font-medium rounded-full ${currentDomainConfig.bgColor} text-white">
              ${article.data.pillColor || 'gray'}
            </span>
            ${article.data.featured ? '<span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Featured</span>' : ''}
          </div>
          <span class="text-xs text-gray-500 dark:text-gray-400">
            ${article.data.readingTime} min
          </span>
        </div>
        
        <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors cursor-pointer">
          ${article.data.title}
        </h3>
        
        <p class="text-gray-600 dark:text-gray-300 text-xs mb-3 line-clamp-2 leading-relaxed">
          ${article.data.description}
        </p>
        
        <div class="flex items-center justify-between">
          <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
            <i class="fas fa-calendar mr-1"></i>
            <span>${new Date(article.data.publishDate).toLocaleDateString('fr-FR')}</span>
          </div>
          
          <a href="/blog/${article.slug}" class="inline-flex items-center px-3 py-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl text-xs group-hover:scale-105" onclick="console.log('Bouton Lire cliqu√©:', '/blog/${article.slug}'); window.location.href='/blog/${article.slug}'; return false;">
            Lire
            <i class="fas fa-arrow-right ml-1 text-xs group-hover:translate-x-1 transition-transform"></i>
          </a>
        </div>
        
        <!-- Tags et Skills pour la lisibilit√© -->
        <div class="mt-3 flex flex-wrap gap-1">
          ${(article.data.tags || []).slice(0, 3).map((tag: string) => 
            `<span class="px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">${tag}</span>`
          ).join('')}
          ${(article.data.skills || []).slice(0, 2).map((skill: string) => 
            `<span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full">${skill}</span>`
          ).join('')}
        </div>
      `;
      
      // Ajouter un gestionnaire de clic pour rendre tout l'article cliquable
      articleElement.addEventListener('click', function(e) {
        // √âviter la propagation si on clique sur le bouton "Lire"
        if ((e.target as HTMLElement).closest('a')) {
          return;
        }
        
        // Rediriger vers l'article
        console.log('Article cliqu√©, redirection vers:', `/blog/${article.slug}`);
        window.location.href = `/blog/${article.slug}`;
      });
      
      // Ajouter un gestionnaire direct pour le bouton "Lire"
      const readButton = articleElement.querySelector('a[href*="/blog/"]') as HTMLAnchorElement;
      if (readButton) {
        readButton.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Bouton "Lire" cliqu√© directement:', readButton.href);
          window.location.href = readButton.href;
        });
      }
      
      return articleElement;
    }

    // Animation des sections au scroll
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-fade-in-up');
        }
      });
    }, observerOptions);

    const domainSections = document.querySelectorAll('.domain-section-3d');
    domainSections.forEach((section: Element) => {
      observer.observe(section);
    });

    // Navigation d√©l√©gu√©e (s√©curit√©) pour tous les liens d'articles
    const domainesContainerEl = document.getElementById('domainesContainer');
    if (domainesContainerEl) {
      domainesContainerEl.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        const link = target.closest('a[href^="/blog/"]') as HTMLAnchorElement | null;
        if (link) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Navigation d√©l√©gu√©e vers:', link.href);
          window.location.href = link.getAttribute('href') || link.href;
        }
      }, { capture: true });
    }

    // Logique de recherche personnalis√©e pour les domaines
    const searchInput = document.getElementById('searchInput') as HTMLInputElement;
    const clearButton = document.getElementById('clearSearch') as HTMLButtonElement;
    const activeFiltersContainer = document.getElementById('activeFilters');
    const domainesContainer = document.getElementById('domainesContainer');
    
    if (searchInput && clearButton && domainesContainer) {
      const domainSections = domainesContainer.querySelectorAll('.domain-section-3d, .domain-section');
      const noResultsEl = document.createElement('div');
      noResultsEl.className = 'col-span-full text-center py-12 text-gray-500 dark:text-gray-400';
      noResultsEl.innerHTML = '<div class="text-6xl mb-4">üîç</div><p class="text-xl">Aucun domaine ou article trouv√©</p><p class="text-sm mt-2">Essayez avec d\'autres mots-cl√©s</p>';
      noResultsEl.style.display = 'none';
      domainesContainer.appendChild(noResultsEl);
      
      // Fonction pour effectuer la recherche
      function performSearch() {
        const query = searchInput.value.toLowerCase().trim();
        console.log('Recherche effectu√©e:', query);
        let hasResults = false;
        
        // G√©rer l'affichage du bouton d'effacement
        clearButton.style.display = query ? 'block' : 'none';
        
        // Filtrer les domaines
        domainSections.forEach(section => {
          const domainName = section.querySelector('h3, h2')?.textContent?.toLowerCase() || '';
          const domainDescription = section.querySelector('p')?.textContent?.toLowerCase() || '';
          const articles = section.querySelectorAll('article');
          let domainHasMatches = false;
          
          // V√©rifier si le nom ou la description du domaine correspond
          const domainMatches = domainName.includes(query) || domainDescription.includes(query);
          
          // V√©rifier les articles dans ce domaine
          articles.forEach(article => {
            const articleTitle = article.querySelector('h3, h4')?.textContent?.toLowerCase() || '';
            const articleDescription = article.querySelector('p')?.textContent?.toLowerCase() || '';
            const articleTags = Array.from(article.querySelectorAll('.tag, span, .px-2'))
              .map(tag => tag.textContent?.toLowerCase() || '');
            
            // Recherche plus large dans le contenu de l'article
            const articleContent = article.textContent?.toLowerCase() || '';
            
            const articleMatches = 
              articleTitle.includes(query) || 
              articleDescription.includes(query) || 
              articleContent.includes(query) ||
              articleTags.some(tag => tag.includes(query));
            
            if (articleMatches) {
              (article as HTMLElement).style.display = '';
              domainHasMatches = true;
              console.log('Article affich√©:', articleTitle);
            } else {
              (article as HTMLElement).style.display = query ? 'none' : '';
              console.log('Article masqu√©:', articleTitle, 'query:', query);
            }
          });
          
          // Afficher ou masquer le domaine
          if (domainMatches || domainHasMatches || !query) {
            (section as HTMLElement).style.display = '';
            hasResults = true;
          } else {
            (section as HTMLElement).style.display = 'none';
          }
        });
        
        // Afficher ou masquer le message "Aucun r√©sultat"
        noResultsEl.style.display = !hasResults && query ? 'block' : 'none';
        
        // Mise √† jour des filtres actifs
        updateActiveFilters(query);
      }
      
      // Mettre √† jour les filtres actifs
      function updateActiveFilters(query: string) {
        if (activeFiltersContainer) {
          activeFiltersContainer.innerHTML = '';
          if (query) {
            const filterEl = document.createElement('span');
            filterEl.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200';
            filterEl.innerHTML = `"${query}" <button class="ml-2 text-indigo-600 hover:text-indigo-800" onclick="clearSearch()">√ó</button>`;
            activeFiltersContainer.appendChild(filterEl);
          }
        }
      }
      
      // Fonction pour effacer la recherche
      function clearSearch() {
        searchInput.value = '';
        performSearch();
      }
      
      // √âv√©nements
      searchInput.addEventListener('input', performSearch);
      clearButton.addEventListener('click', clearSearch);
      
      // Exposer la fonction globalement pour les filtres actifs
      (window as any).clearSearch = clearSearch;
      
      console.log('Script initialis√© avec succ√®s');
      
      // S'assurer que tous les domaines sont visibles au chargement
      showAllDomains();
    }
  });
</script>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .animate-fade-in-up {
    animation: fadeInUp 0.6s ease-out forwards;
    opacity: 0;
    transform: translateY(30px);
  }
  
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .domain-pill-nav {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .domain-pill-nav:hover {
    backdrop-filter: blur(15px);
    border-color: rgba(255, 255, 255, 0.3);
  }


  /* Effet 3D pour les sections de domaines */
  .domain-section-3d {
    transform-style: preserve-3d;
    perspective: 1000px;
    position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 
      0 8px 16px rgba(0, 0, 0, 0.1),
      0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  .domain-section-3d::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border-radius: inherit;
    transform: translateZ(-2px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .domain-section-3d::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(255,255,255,0.15) 0%, transparent 50%);
    border-radius: inherit;
    transform: translateZ(2px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .domain-section-3d:hover {
    transform: translateZ(50px) scale(1.05) translateY(-10px);
    box-shadow: 
      0 30px 60px rgba(0, 0, 0, 0.25),
      0 15px 30px rgba(0, 0, 0, 0.15),
      0 5px 10px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }
  
  .domain-section-3d:hover::before {
    opacity: 1;
  }
  
  .domain-section-3d:hover::after {
    opacity: 1;
  }

  /* Effet cube pour les cartes d'articles */
  .article-card-3d {
    transform-style: preserve-3d;
    position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 
      0 4px 8px rgba(0, 0, 0, 0.1),
      0 1px 2px rgba(0, 0, 0, 0.1);
  }
  
  .article-card-3d::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.03) 100%);
    border-radius: inherit;
    transform: translateZ(-1px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .article-card-3d::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(255,255,255,0.12) 0%, transparent 50%);
    border-radius: inherit;
    transform: translateZ(1px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .article-card-3d:hover {
    transform: translateZ(30px) scale(1.03) translateY(-5px);
    box-shadow: 
      0 20px 40px rgba(0, 0, 0, 0.15),
      0 8px 16px rgba(0, 0, 0, 0.1),
      0 2px 4px rgba(0, 0, 0, 0.05),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
  }
  
  .article-card-3d:hover::before {
    opacity: 1;
  }
  
  .article-card-3d:hover::after {
    opacity: 1;
  }

  /* Effet cube pour les boutons */
  .load-more-btn-3d {
    transform-style: preserve-3d;
    position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 
      0 4px 12px rgba(99, 102, 241, 0.3),
      0 2px 4px rgba(99, 102, 241, 0.2);
  }
  
  .load-more-btn-3d::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
    border-radius: inherit;
    transform: translateZ(-1px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .load-more-btn-3d::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(255,255,255,0.25) 0%, transparent 50%);
    border-radius: inherit;
    transform: translateZ(1px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .load-more-btn-3d:hover {
    transform: translateZ(35px) scale(1.08) translateY(-3px);
    box-shadow: 
      0 20px 40px rgba(99, 102, 241, 0.4),
      0 8px 16px rgba(99, 102, 241, 0.3),
      0 2px 4px rgba(99, 102, 241, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
  }
  
  .load-more-btn-3d:hover::before {
    opacity: 1;
  }
  
  .load-more-btn-3d:hover::after {
    opacity: 1;
  }


  .domain-section-3d {
    animation: cube-entrance 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }
  
  .domain-section-3d:nth-child(2n) {
    animation-delay: 0.2s;
  }
  
  .domain-section-3d:nth-child(3n) {
    animation-delay: 0.4s;
  }

  /* Styles pour les pills de filtrage avec d√©grad√©s */
  .filter-pill {
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .filter-pill::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
  }
  
  .filter-pill:hover::before {
    left: 100%;
  }
  
  .filter-pill:active {
    transform: scale(0.95);
  }
  
  /* Effet de brillance pour les pills actives */
  .filter-pill.ring-4 {
    position: relative;
  }
  
  .filter-pill.ring-4::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, rgba(255, 255, 255, 0.3), transparent, rgba(255, 255, 255, 0.3));
    border-radius: inherit;
    z-index: -1;
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Styles pour les pills de filtrage par domaines */
  .domain-filter-pill {
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 1;
  }
  
  .domain-filter-pill::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
  }
  
  .domain-filter-pill:hover::before {
    left: 100%;
  }
  
  .domain-filter-pill:hover {
    transform: scale(1.25);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    z-index: 10;
    border-color: rgba(255, 255, 255, 0.4);
    animation: zoom-pulse 0.6s ease-in-out;
  }
  
  .domain-filter-pill.ring-4 {
    transform: scale(1.2);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    border-color: rgba(255, 255, 255, 0.6);
    z-index: 20;
  }
  
  .domain-filter-pill:active {
    transform: scale(1.1);
    transition: all 0.1s ease;
  }
  
  @keyframes zoom-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1.25); }
  }
</style>