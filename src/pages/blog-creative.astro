---
import { getCollection } from 'astro:content';
import { getFeaturedArticlesForDomain } from '../config/featured-articles';
import BaseLayout from '../layouts/BaseLayout.astro';

// R√©cup√©ration des articles et livres
const articles = await getCollection('articles');
const books = await getCollection('books');

// Tri des articles par date de publication (du plus r√©cent au plus ancien)
const sortedArticles = articles.sort((a, b) => {
	const dateA = new Date(a.data.publishDate || '2024-01-01');
	const dateB = new Date(b.data.publishDate || '2024-01-01');
	return dateB.getTime() - dateA.getTime();
});

// Tri des livres par ann√©e de publication
const sortedBooks = books.sort((a, b) => (b.data.publishYear || 0) - (a.data.publishYear || 0));

// Fonction pour obtenir les articles d'un domaine sp√©cifique
function getArticlesForDomain(domain: string) {
  const featuredSlugs = getFeaturedArticlesForDomain(domain);
  return articles.filter(article => 
    featuredSlugs.includes(article.slug)
  ).sort((a, b) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime();
  });
}

// D√©finition des domaines de comp√©tence avec 2 articles maximum par domaine
const domainesCompetences = {
	"Formation & P√©dagogie": {
		description: "Articles sur la formation, le d√©veloppement des comp√©tences et l'apprentissage continu",
		color: "red",
		icon: "fas fa-graduation-cap",
		gradient: "from-red-500 to-pink-600",
		articles: getArticlesForDomain('formation').slice(0, 2)
	},
	"Gestion de Projet T√©l√©com": {
		description: "Pilotage de projets complexes, gestion d'√©quipes et m√©thodologies agiles",
		color: "blue", 
		icon: "fas fa-tasks",
		gradient: "from-blue-500 to-indigo-600",
		articles: getArticlesForDomain('gestion-projet').slice(0, 2)
	},
	"D√©veloppement Web & Technologies": {
		description: "Tendances, technologies et bonnes pratiques du d√©veloppement web moderne",
		color: "purple",
		icon: "fas fa-code",
		gradient: "from-purple-500 to-violet-600",
		articles: getArticlesForDomain('developpement-web').slice(0, 2)
	},
	"Qualit√© & Processus": {
		description: "Am√©lioration continue, certification et optimisation des processus",
		color: "orange",
		icon: "fas fa-check-circle",
		gradient: "from-orange-500 to-red-600",
		articles: getArticlesForDomain('qualite-process').slice(0, 2)
	},
	"Gestion des Talents": {
		description: "Strat√©gies et m√©thodes pour g√©rer, d√©velopper et fid√©liser les talents",
		color: "green",
		icon: "fas fa-users",
		gradient: "from-green-500 to-emerald-600",
		articles: getArticlesForDomain('gestion-talents').slice(0, 2)
	},
	"Productivit√© & M√©thodes": {
		description: "Techniques de productivit√©, gestion du temps et m√©thodes de travail",
		color: "teal",
		icon: "fas fa-clock",
		gradient: "from-teal-500 to-cyan-600",
		articles: getArticlesForDomain('productivite-methodes').slice(0, 2)
	}
};

// Livres recommand√©s (top 4)
const livresRecommandes = sortedBooks.slice(0, 4);

// Couleurs pour les badges
const colorClasses = {
	red: "bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",
	blue: "bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",
	purple: "bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",
	orange: "bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",
	green: "bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",
	teal: "bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-300"
};

// Fonction pour formater la date
function formatDate(date: Date | string): string {
	const dateObj = typeof date === 'string' ? new Date(date) : date;
	return dateObj.toLocaleDateString('fr-FR', {
		year: 'numeric',
		month: 'long',
		day: 'numeric'
	});
}

// Statistiques
const totalArticles = articles.length;
const totalBooks = books.length;
const totalDomaines = Object.keys(domainesCompetences).length;
---

<BaseLayout title="Blog | G√©rald Pam√©ole" description="D√©couvrez mes articles sur le d√©veloppement web, la gestion de projet, la formation et bien plus encore.">
	<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-hidden">
		<!-- Hero Section avec Animation 3D -->
		<section class="relative py-32 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white overflow-hidden">
			<!-- Background Animation Complexe -->
			<div class="absolute inset-0">
				<div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-indigo-600/20 to-purple-600/20"></div>
				<div class="absolute top-1/4 left-1/4 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
				<div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-white/5 rounded-full blur-3xl animate-pulse delay-1000"></div>
				<div class="absolute top-1/2 left-1/2 w-32 h-32 bg-white/15 rounded-full blur-2xl animate-bounce delay-500"></div>
				<!-- Formes g√©om√©triques flottantes -->
				<div class="absolute top-20 left-20 w-4 h-4 bg-white/20 rotate-45 animate-spin"></div>
				<div class="absolute top-40 right-32 w-6 h-6 bg-white/15 rounded-full animate-ping"></div>
				<div class="absolute bottom-32 left-1/3 w-3 h-3 bg-white/25 rotate-12 animate-pulse"></div>
				<div class="absolute top-60 right-20 w-5 h-5 bg-white/10 rounded-full animate-bounce delay-700"></div>
			</div>
			
			<div class="container mx-auto px-4 text-center relative z-10">
				<div class="animate-fade-in-up">
					<h1 class="text-6xl md:text-8xl font-black mb-8 bg-gradient-to-r from-white via-purple-200 to-pink-200 bg-clip-text text-transparent animate-gradient">
						üìù Blog
					</h1>
					<h2 class="text-4xl md:text-6xl font-bold mb-6 text-white/90 animate-slide-in-right">
						& Articles
					</h2>
				</div>
				<p class="text-xl md:text-2xl max-w-4xl mx-auto mb-12 opacity-90 animate-fade-in-up delay-300">
					Explorez mes articles organis√©s par <span class="text-yellow-300 font-bold">domaine d'expertise</span>. 
					D√©couvrez des contenus <span class="text-pink-300 font-bold">sp√©cialis√©s</span> sur le d√©veloppement web, 
					la gestion de projet, la formation et <span class="text-cyan-300 font-bold">bien plus encore</span>.
				</p>
				
				<!-- Statistiques avec Animation Staggered -->
				<div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
					<div class="group bg-white/10 backdrop-blur-sm rounded-3xl p-8 hover:bg-white/20 transition-all duration-500 transform hover:scale-110 hover:rotate-1 animate-fade-in-up delay-100">
						<div class="text-5xl font-black mb-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
							{totalArticles}
						</div>
						<div class="text-sm opacity-90 font-medium">Articles</div>
					</div>
					<div class="group bg-white/10 backdrop-blur-sm rounded-3xl p-8 hover:bg-white/20 transition-all duration-500 transform hover:scale-110 hover:-rotate-1 animate-fade-in-up delay-200">
						<div class="text-5xl font-black mb-2 bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">
							{totalBooks}
						</div>
						<div class="text-sm opacity-90 font-medium">Livres</div>
					</div>
					<div class="group bg-white/10 backdrop-blur-sm rounded-3xl p-8 hover:bg-white/20 transition-all duration-500 transform hover:scale-110 hover:rotate-1 animate-fade-in-up delay-300">
						<div class="text-5xl font-black mb-2 bg-gradient-to-r from-pink-400 to-purple-500 bg-clip-text text-transparent">
							{totalDomaines}
						</div>
						<div class="text-sm opacity-90 font-medium">Domaines</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Section Livres Recommand√©s avec Style Cr√©atif -->
		<section class="py-20 bg-gradient-to-br from-slate-800 to-purple-900 relative">
			<div class="container mx-auto px-4">
				<div class="text-center mb-16">
					<div class="transform -rotate-1 inline-block">
						<h2 class="text-5xl font-black mb-6 bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent animate-gradient">
							üìö Livres Recommand√©s
						</h2>
					</div>
					<p class="text-xl text-white/80 max-w-3xl mx-auto">
						D√©couvrez ma s√©lection de livres qui ont <span class="text-yellow-300 font-bold">marqu√©</span> mon parcours professionnel.
					</p>
					<div class="mt-8">
						<a 
							href="/livres" 
							class="group inline-flex items-center px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-2xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-110 hover:-rotate-1 shadow-2xl"
						>
							Voir tous les livres
							<svg class="ml-3 w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
							</svg>
						</a>
					</div>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
					{livresRecommandes.map((book, index) => (
						<div class={`group relative animate-fade-in-up delay-${index * 100}`}>
							<div class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden hover:shadow-purple-500/25 transition-all duration-500 transform hover:scale-105 hover:-rotate-1 border border-white/20">
								<div class="relative h-64 bg-gradient-to-br from-indigo-500 to-purple-600">
									<div class="absolute inset-0 bg-black/20"></div>
									<div class="absolute bottom-4 left-4 text-white">
										<div class="flex items-center space-x-2">
											<span class="text-sm font-medium">{book.data.publishYear}</span>
											{book.data.note && (
												<>
													<span class="text-sm">‚Ä¢</span>
													<div class="flex items-center">
														{Array.from({ length: 5 }).map((_, i) => (
															<svg 
																key={i}
																class={`w-4 h-4 ${i < book.data.note! ? 'text-yellow-400' : 'text-gray-300'} transform group-hover:scale-110 transition-transform`}
																fill="currentColor" 
																viewBox="0 0 20 20"
															>
																<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
															</svg>
														))}
													</div>
												</>
											)}
										</div>
									</div>
									{book.data.featured && (
										<div class="absolute top-4 right-4">
											<span class="bg-yellow-400 text-yellow-900 px-2 py-1 rounded-full text-xs font-medium">
												‚≠ê Mis en avant
											</span>
										</div>
									)}
								</div>

								<div class="p-6">
									<h3 class="text-xl font-bold text-white mb-3 line-clamp-2 group-hover:text-yellow-300 transition-colors">
										{book.data.title}
									</h3>
									<p class="text-sm text-white/70 mb-3">
										par {book.data.author}
									</p>
									<p class="text-white/80 text-sm line-clamp-3 mb-4">
										{book.data.description}
									</p>
									
									<a 
										href={`/books/${book.slug}`}
										class="inline-flex items-center text-indigo-300 hover:text-yellow-300 font-medium text-sm transform hover:translate-x-1 transition-all"
									>
										Lire la critique
										<svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
										</svg>
									</a>
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		</section>

		<!-- Articles par Domaine avec Layout Cr√©atif -->
		<section class="py-20 bg-gradient-to-br from-purple-900 to-slate-900">
			<div class="container mx-auto px-4">
				<div class="text-center mb-16">
					<div class="transform rotate-1 inline-block">
						<h2 class="text-5xl font-black mb-6 bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent animate-gradient">
							üéØ Articles par Domaine
						</h2>
					</div>
					<p class="text-xl text-white/80 max-w-3xl mx-auto">
						Explorez mes articles <span class="text-yellow-300 font-bold">sp√©cialis√©s</span>, organis√©s par domaine de comp√©tence.
					</p>
				</div>

				<div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
					{Object.entries(domainesCompetences).map(([domainName, domain], index) => (
						<div class={`group relative animate-fade-in-up delay-${index * 150}`}>
							<div class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden hover:shadow-purple-500/25 transition-all duration-500 transform hover:scale-105 hover:-rotate-1 border border-white/20">
								<!-- Header du domaine avec gradient -->
								<div class={`bg-gradient-to-r ${domain.gradient} p-8 text-white relative overflow-hidden`}>
									<div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
									<div class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"></div>
									
									<div class="relative z-10">
										<div class="flex items-center mb-4">
											<div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mr-4 backdrop-blur-sm transform group-hover:rotate-12 transition-transform">
												<i class={`${domain.icon} text-2xl`}></i>
											</div>
											<div>
												<h3 class="text-2xl font-bold">{domainName}</h3>
												<p class="text-sm opacity-90">{domain.articles.length} article{domain.articles.length > 1 ? 's' : ''} s√©lectionn√©{domain.articles.length > 1 ? 's' : ''}</p>
											</div>
										</div>
										<p class="text-sm opacity-90 leading-relaxed">{domain.description}</p>
									</div>
								</div>

								<!-- Articles du domaine -->
								<div class="p-8">
									{domain.articles.length > 0 ? (
										<div class="space-y-6">
											{domain.articles.map((article, articleIndex) => (
												<article class={`group/article bg-gradient-to-r from-white/5 to-white/10 backdrop-blur-sm rounded-2xl p-6 hover:from-white/10 hover:to-white/15 transition-all duration-300 transform hover:scale-105 hover:-rotate-1 border border-white/10 animate-fade-in-up delay-${articleIndex * 100}`}>
													<div class="flex items-start space-x-4">
														<div class="flex-shrink-0">
															<div class={`w-12 h-12 bg-gradient-to-r ${domain.gradient} rounded-xl flex items-center justify-center transform group-hover/article:rotate-12 transition-transform`}>
																<i class={`${domain.icon} text-white text-lg`}></i>
															</div>
														</div>
														<div class="flex-1 min-w-0">
															<h4 class="text-lg font-semibold text-white mb-2 group-hover/article:text-yellow-300 transition-colors line-clamp-2">
																{article.data.title}
															</h4>
															<p class="text-white/70 text-sm mb-3 line-clamp-2">
																{article.data.description}
															</p>
															<div class="flex items-center justify-between">
																<div class="flex items-center space-x-4 text-xs text-white/50">
																	<span>{formatDate(article.data.publishDate)}</span>
																	<span>‚Ä¢</span>
																	<span>{article.data.readingTime} min</span>
																	{article.data.featured && (
																		<>
																			<span>‚Ä¢</span>
																			<span class="text-yellow-400">‚≠ê Mis en avant</span>
																		</>
																	)}
																</div>
																<a 
																	href={`/articles/${article.slug}`}
																	class="text-indigo-300 hover:text-yellow-300 font-medium text-sm flex items-center transform hover:translate-x-1 transition-all"
																>
																	Lire
																	<svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
																		<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
																	</svg>
																</a>
															</div>
														</div>
													</div>
												</article>
											))}
											
											<!-- Lien vers plus d'articles -->
											<div class="pt-4 border-t border-white/20">
												<a 
													href={`/domaines#${domainName.toLowerCase().replace(/\s+/g, '-')}`}
													class="inline-flex items-center w-full justify-center px-6 py-3 bg-gradient-to-r from-white/10 to-white/5 text-white rounded-xl hover:from-white/20 hover:to-white/10 transition-all duration-300 font-medium transform hover:scale-105"
												>
													Voir tous les articles de {domainName}
													<svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
														<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
													</svg>
												</a>
											</div>
										</div>
									) : (
										<div class="text-center py-12">
											<div class="w-16 h-16 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-4 transform rotate-12">
												<i class={`${domain.icon} text-2xl text-white/50`}></i>
											</div>
											<h3 class="text-lg font-medium text-white mb-2">Aucun article disponible</h3>
											<p class="text-white/60">Des articles seront bient√¥t ajout√©s dans ce domaine.</p>
										</div>
									)}
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		</section>

		<!-- CTA Section avec Style D√©cal√© -->
		<section class="py-24 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white relative overflow-hidden">
			<!-- Background Animation -->
			<div class="absolute inset-0">
				<div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-indigo-600/20 to-purple-600/20"></div>
				<div class="absolute top-1/4 left-1/4 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
				<div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-white/5 rounded-full blur-3xl animate-pulse delay-1000"></div>
			</div>
			
			<div class="container mx-auto px-4 text-center relative z-10">
				<div class="transform rotate-1 inline-block">
					<h2 class="text-6xl font-black mb-8 bg-gradient-to-r from-white via-yellow-200 to-pink-200 bg-clip-text text-transparent animate-gradient">
						Pr√™t √† explorer ?
					</h2>
				</div>
				<p class="text-2xl mb-12 max-w-4xl mx-auto opacity-90">
					D√©couvrez tous mes articles, explorez mes <span class="text-yellow-300 font-bold">domaines d'expertise</span> 
					ou contactez-moi pour discuter de vos <span class="text-pink-300 font-bold">besoins</span>.
				</p>
				<div class="flex flex-col sm:flex-row gap-8 justify-center">
					<a 
						href="/domaines" 
						class="group inline-flex items-center px-12 py-6 bg-white text-indigo-600 font-bold rounded-2xl hover:bg-gray-100 transition-all duration-300 transform hover:scale-110 hover:-rotate-1 shadow-2xl"
					>
						Explorer les domaines
						<svg class="ml-3 w-6 h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</a>
					<a 
						href="/contact" 
						class="group inline-flex items-center px-12 py-6 border-2 border-white text-white font-bold rounded-2xl hover:bg-white hover:text-indigo-600 transition-all duration-300 transform hover:scale-110 hover:rotate-1"
					>
						Me contacter
						<svg class="ml-3 w-6 h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
						</svg>
					</a>
				</div>
			</div>
		</section>
	</div>
</BaseLayout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	@keyframes fade-in-up {
		from { 
			opacity: 0; 
			transform: translateY(30px); 
		}
		to { 
			opacity: 1; 
			transform: translateY(0); 
		}
	}

	@keyframes slide-in-right {
		from { 
			opacity: 0; 
			transform: translateX(30px); 
		}
		to { 
			opacity: 1; 
			transform: translateX(0); 
		}
	}

	@keyframes gradient {
		0%, 100% { background-position: 0% 50%; }
		50% { background-position: 100% 50%; }
	}

	.animate-fade-in-up {
		animation: fade-in-up 0.8s ease-out forwards;
	}

	.animate-slide-in-right {
		animation: slide-in-right 1s ease-out;
	}

	.animate-gradient {
		background-size: 200% 200%;
		animation: gradient 3s ease infinite;
	}

	/* D√©lais d'animation */
	.delay-100 { animation-delay: 0.1s; }
	.delay-200 { animation-delay: 0.2s; }
	.delay-300 { animation-delay: 0.3s; }
	.delay-500 { animation-delay: 0.5s; }
	.delay-700 { animation-delay: 0.7s; }
	.delay-1000 { animation-delay: 1s; }

	/* Effets de hover avanc√©s */
	.group:hover .group-hover\:translate-x-1 {
		transform: translateX(0.25rem);
	}

	.group:hover .group-hover\:scale-110 {
		transform: scale(1.1);
	}

	.group:hover .group-hover\:rotate-12 {
		transform: rotate(12deg);
	}

	/* Scroll animations */
	@media (prefers-reduced-motion: no-preference) {
		.animate-fade-in-up {
			opacity: 0;
			transform: translateY(30px);
			animation: fade-in-up 0.8s ease-out forwards;
		}
	}
</style>
